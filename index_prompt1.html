<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>👩‍🍳شو عاملي أكل؟👩‍🍳</title>
    <style>
    #enter-app-button:hover {
    background-color: #047857;
    transform: scale(1.05);
}

/* تنسيق عام لأزرار اللغة */
.lang-btn {
    height: 50px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
    color: #059669;
}

        /* الصفحة RTL والخلفية */
        body {
            direction: rtl;
            text-align: center;
            font-family: sans-serif , Tahoma 'Segoe UI', Geneva, Verdana, ;
            margin: 0;
            padding: 0;
            color: #e4e75e;
            background: linear-gradient(135deg, #f5f0e1, #8b4513, #a52a2a);
            min-height: 100vh;
        }

        /* الشريط العلوي Header – نص دوار */
        header {
            padding: 25px 20px;
            text-align: center;
            perspective: 1000px;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #ff7f50, #ff4500);
            border-radius: 20px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
        }

        header h1 {
            display: inline-block;
            font-size: 1.2em;
            font-weight: bold;
            animation: rotateText ;
            animation-duration: 18s; 
            animation-timing-function: linear; 
            animation-iteration-count: infinite; 
        }

        @keyframes rotateText {
                       /* ------------------ 1. المرحلة الخضراء (0s - 6s) ------------------ */
            0% { 
                transform: rotateY(0deg); 
                color: #10b981; /* أخضر */
            }
            /* الدوران يكتمل عند 16.6% (3 ثوانٍ) */
            16.6% { 
                transform: rotateY(360deg); 
                color: #10b981; 
            }
            /* فترة التوقف حتى 33.3% (6 ثوانٍ) */
            33.3% { 
                transform: rotateY(360deg); 
                color: #10b981; 
            }

            /* ------------------ 2. المرحلة الزرقاء (6s - 12s) ------------------ */
            /* تغيير اللون والدوران للصفر في لحظة */
            33.4% { 
                transform: rotateY(0deg); 
                color: #eceef2; /* أبيض */
            }
            /* الدوران يكتمل عند 50% (9 ثوانٍ) */
            50% { 
                transform: rotateY(360deg); 
                color: #eceef2; 
            }
            /* فترة التوقف حتى 66.6% (12 ثانية) */
            66.6% { 
                transform: rotateY(360deg); 
                color: #eceef2; 
            }

            /* ------------------ 3. المرحلة السوداء (12s - 18s) ------------------ */
            /* تغيير اللون والدوران للصفر في لحظة */
            66.7% { 
                transform: rotateY(0deg); 
                color: #000000; /* أسود */
            }
            /* الدوران يكتمل عند 83.3% (15 ثانية) */
            83.3% { 
                transform: rotateY(360deg); 
                color: #000000; 
            }
            /* فترة التوقف حتى 100% (18 ثانية) */
            100% { 
                transform: rotateY(360deg); 
                color: #10b981; 
            }
        }
        
        /* ======================================================= */
        /* 🚀 تنسيق وضع اللغة الإنجليزية (LTR) - تم دمجه هنا */
        /* ======================================================= */
        .english-mode {
         
        }
        
        /* هذا التنسيق يفرض الاتجاه من اليسار لليمين */
        html[dir="ltr"] body {
            text-align: center !important;
        }
        
        /* هذا التنسيق يضمن محاذاة العناصر الداخلية لليسار في وضعية الإنجليزية */
        .english-mode main {
            text-align: center !important;
        }
        .english-mode .meal-title{
        text-align: center !important;
        }
        .english-mode .preparation-section,
        .english-mode .ingredients-section {
            text-align:left !important;
            direction: ltr !important;
        }
        
        /* 1. تحديد العرض الأقصى و الهامش الجانبي القابل للتعديل */
        main {
            max-width: 600px; 
            margin: 0 auto 30px; 
            padding: 20px; 
            background-color: rgba(0,0,0,0.7);
            border-radius: 20px;
            box-shadow: 0 6px 15px rgba(0,0,0,0.3);
        }

        .buttons-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .buttons-container button {
            background: linear-gradient(45deg, #03e5e9, #0996c5);
            color: rgb(46, 3, 3);
            padding: 10px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: transform 0.2s ease;
        }

        .buttons-container button:hover {
            transform: scale(1.05);
        }

        /* التسمية */
        label {
            display: block;
            margin: 15px 0 5px;
            font-weight: bold;
            font-size: 1.05em;
        }

        /* القوائم المنسدلة select */
        select {
            width: 100%;
            padding: 12px;
            border-radius: 12px;
            border: 1px solid #241313;
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 10px;
            transition: border-color 0.3s, box-shadow 0.3s;
            direction: ltr; /* للحفاظ على تنسيق الأرقام والحروف اللاتينية */
            text-align: left ; /* للحفاظ على تنسيق الأرقام والحروف اللاتينية */
            background-color: #222;
            color: #cfbd88;
        }

        select:focus {
            border-color: #00ff99;
            box-shadow: 0 0 5px #00ff99;
            outline: none;
        }

        /* الأزرار نافرة */
        button {
            word-spacing: 12px;
            margin-top: 20px;
            padding: 15px 20px;
            width: 100%;
            border: none;
            border-radius: 15px;
            background: linear-gradient(to right, #a0ff99, #50c878);
            color: #000;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }
        
       /* تنسيق أزرار  اللغة في صف واحد (Container) */
.lang-switcher-row {
    display: flex; /* وضع الأزرار جنباً إلى جنب */
    justify-content: center; /* توسيط الأزرار */
    gap: 8px; /* مسافة بين الأزرار */
    margin-bottom: 15px;
}

/* تنسيق الأزرار الفردية */
.lang-btn {
    padding: 6px 10px;
    border: 2px solid transparent; /* لجعل الحدود مرئية عند التنشيط */
    border-radius: 8px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.3s ease; /* لتأثير الإضاءة السلس */
    color: #4A4A4A; /* لون نص مطفأ */
    background-color: #E0E0E0; /* خلفية مطفأة */
}

/* حالة الزر النشط (المُضاء) */
.lang-btn.active {
    background: linear-gradient(to right, #66ff99, #70d2c8); /* نفس تدرج اللون الذي طلبته */
    color: #000000; /* لون نص ساطع */
    border-color: #E91E63; /* تحديد بإطار وردي */
    box-shadow: 0 0 10px rgba(102, 255, 153, 0.7); /* إضافة ظل خفيف للإضاءة */
}
        

        /* ==================================== */
        /* 🚀  تنسيقات القائمة المنسدلة (الجديدة) */
        /* ==================================== */

        /* تنسيقات الـ Dropdown */
        .dropdown {
            position: relative; 
            display: inline-block;
            width: 100%; 
            margin-bottom: 15px;
        }

        /* تنسيقات زر القائمة (يستبدل تنسيق الزر القديم) */
        .dropbtn {
            background: linear-gradient(to right, #66ff99, #70d2c8);
            color: #2c0bbc;
            font-weight: bold;
            width: 100%;
            padding: 15px 20px;
            border: none;
            border-radius: 15px;
            font-size: 1.2em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.3s;
        }

        /* محتوى القائمة المنسدلة (المخفي افتراضياً) */
        .dropdown-content {
            display: none; 
            position: absolute;
            background-color: #f9f9f9;
            min-width: 100%;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 100; /* قيمة عالية لضمان الظهور فوق كل شيء */
            border-radius: 10px;
            overflow: hidden;
        }

        /* تنسيق خيارات القائمة */
        .dropdown-content a {
            color: black;
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            text-align: right; 
            font-size: 1em;
        }

        /* تأثير التمرير على الخيارات */
        .dropdown-content a:hover {
            background-color: #f1f1f1;
            color: #4ECDC4;
        }

        /* إظهار القائمة عندما تكون النشطة */
        .dropdown-content.show {
            display: block;
        }

        /* ... نهاية أكواد CSS الخاصة بك ... */
        /* صندوق النتائج */
        #result {
            margin-top: 30px;
            padding: 20px;
            border-radius: 15px;
            background-color: rgba(255,255,255,0.1);
            font-size: 1.15em;
            line-height: 1.5em;
            box-shadow: 0 3px 8px rgba(0,0,0,0.2);
        }

        /* الساعة الرقمية */
        .clock {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        .clock span {
            font-size: 1.5em;
            font-weight: bold;
            color: #0f1cb8;
        }

        /* التصميم المتجاوب للشاشات الأصغر من 650px */
        @media (max-width: 650px) {
            main {
                margin: 20px;
                padding: 20px;
            }
            header {
                font-size: 1.8em;
                padding: 20px 15px;
            }
            select, button {
                font-size: 1.0em;
                padding: 10px;
            }
            .clock span {
                font-size: 1.3em;
            }
        }

        /* رسالة الموافقة */
        #confirmationMsg {
            font-weight: bold;
            font-size: 24px;
            color: #e74c3c;
            animation: moveLeftRight 3s infinite alternate, colorChange 3s infinite alternate;
            text-align: left;
            margin-bottom: 15px;
        }

        @keyframes moveLeftRight {
            0% { transform: translateX(0); }
            100% { transform: translateX(20px); }
        }

        @keyframes colorChange {
            0% { color: #e74c3c; }
            50% { color: #f1c40f; }
            100% { color: #2ecc71; }
        }
    /* ---------------------------------------------------- */
        /* 1. الحل الجذري لمشكلة "الواجهة تاخذ اقصى اليمين" */
        /* ---------------------------------------------------- */
        body {
            background-color: #f7f9fb;
            font-family: 'Cairo', sans-serif;
            color: #e4e75e;
            direction: rtl; 
            margin: 0;
            padding: 0;
        }

   /* 🔥🔥🔥🔥🔥🔥 بالطبع! سأكتب لك الكود الجديد🔥🔥🔥🔥🔥🔥الكود الجديد */

/* الحاوية الرئيسية لتوسيط كل المحتوى في المنتصف */
.main-wrapper {
    width: 90vw;
    max-width: 1800px;
    margin: 20px auto;
    padding: 20px;
    background-color: #ffffff;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
}

/* ---------------------------------------------------- */
/* 2. شيفرة CSS التي ارسلتها (مع تصحيح التبادل والمحاذاة) */
/* ---------------------------------------------------- */
.meal-layout {
    display: grid;
    flex-direction: column;
    gap: 20px;
    margin-top: 40px;
    margin: 5px 0;
    width: 100%;
    max-width: 100%;
    background: none;
    padding: 0;
    color: #edd982;
    text-align: center;

}

.meal-content {
    width: 100%;
}

/* 4. النافذتان - ضمان التمدد الرأسي والمرونة */
.preparation-section,
.ingredients-section {
    grid-column: auto;
    margin-top: 0 !important;
    align-self: start !important;
    display: flex;
    flex-direction: column;
    height: 100%;
    width: 100%;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}


/* تفاصيل نافذة طريقة التحضير (العمود الثاني - اليسار) */
.preparation-section {
    margin-top: 0 !important;
    grid-column: 2;
    justify-self: stretch;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    text-align: justify;
    direction: rtl;
    padding: 5px;
    background: rgb(156, 117, 81);
    border-right: 3px solid #4ECDC4;
    border-left: 3px solid #FF6B6B;
}

/* تفاصيل نافذة المكونات (العمود الأول - اليمين) */
.ingredients-section {
    margin-top: 0 !important;
    grid-column: 1;
    justify-self: stretch;
    width: 100%;
    max-width: 100%;
    box-sizing: border-box;
    text-align: right;
    padding: 5px;
    background: rgb(156, 117, 81);
    border-right: 3px solid #4ECDC4;
    border-left: 3px solid #FF6B6B;
}
/* =========================================== */
/* 2. تعديل صناديق العناوين (تطبيق التوسيط والتنسيق) */
/* =========================================== */
.ingredients-section strong,
.preparation-section strong {
    display: block;
    font-size: 18px;
    /* color: #f4c952;*/
    border-bottom: none;
    margin: 0;
    align-self: center;
}

:lang(en) .ingredients-section,
:lang(en) .preparation-section,
:lang(ru) .ingredients-section,
:lang(ru) .preparation-section {
    text-align: left;
    direction: ltr;
}

:lang(en) .ingredients-section > *,
:lang(en) .preparation-section > *,
:lang(ru) .ingredients-section > *,
:lang(ru) .preparation-section > * {
    text-align: left;
    direction: ltr;
}

/* --- بداية التعديلات المطلوبة (لتجميع المكون والأيقونة) --- */

/* 1. تفعيل المحاذاة الأفقية بين الأطراف */
.flex-row-aligned {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 5px 0;
}

/* 2. تجميع الأيقونة واسم المكون معاً في الطرف الأيسر/الأيمن حسب اتجاه النص */
.flex-start-group {
    display: flex;
    align-items: center;
    gap: 8px;

    /* 🎯 التعديل الجوهري: يدفع هذا العنصر إلى الطرف الأقصى في Flexbox */
    margin-inline-end: 0;
    text-align: start;
    margin-inline-start: 0;
}

/* 3. تعديل المحدد .ingredient نفسه */
    .ingredient {
    display: flex;
    align-items: center;
    gap: 10px;
    width: 100%;
    font-size: 18px;
    color: #321081;
    justify-content: flex-start;
    border-bottom: 2px dashed #1edb0d;
}

    .ingredient:last-child {
     border-bottom: none;
}

.ingredient-quantity {
    color: #130135;
    font-weight: 400;
    font-size: 1.1rem;
    white-space: initial;

    /* 🎯 التعديل لضمان بقاء الكمية في الطرف النهائي في كلتا اللغتين */
    margin-inline-start: auto;
    margin-inline-end: 0;
    text-align: end;
}
.scrolling-text {
    background: #e0f2f1;
    padding: 10px;
    border-radius: 8px;
    margin-top: 20px;
    color: #00897b;
    text-align: center;
}

.product-card {
    background: #f0f4c3;
    padding: 15px;
    border-radius: 8px;
    margin-top: 20px;
    text-align: right;
    border: 3px solid #cddc39;
}

.step {
    color: black;
    padding: 2px 0;
    margin: 0 !important;
    font-size: 18px;
    line-height: 1.4;
    width: 100%;
    display: flex;
    align-items: flex-start;
    border-bottom: 2px dashed #1edb0d;
    gap: 2px;
}

    .step:last-child {
    border-bottom: none;
}


/* ترتيب العناصر في .ingredient حسب اللغة */
   .ingredient {
    flex-direction: row;
}

/* في العربية والفارسية: من اليمين لليسار */
.ingredients-section[lang="ar"],
.ingredients-section[lang="fa"] {
   direction: rtl;
    text-align: right;
}
/* في الإنجليزية والروسية: الإيموجي في النهاية، المقادير في البداية */
.ingredients-section[lang="en"],
.ingredients-section[lang="ru"] {
     direction: ltr;
    text-align: left;
}
/* في .preparation-section: من اليمين لليسار للعربية والفارسية، من اليسار لليمين للباقي */
    .preparation-section[lang="ar"],
    .preparation-section[lang="fa"] {
    direction: rtl;
    text-align: right;
}

     .preparation-section[lang="en"],
    .preparation-section[lang="ru"] {
    direction: ltr;
    text-align: left;
}

       /* تصميم متجاوب للجوال (Grid-Template-Columns: 1fr) */
     @media (max-width: 768px) {
    .main-wrapper {
        margin: 0;
        padding: 10px;
        border-radius: 0;
    }

    .meal-layout {
        gap: 15px;
    }

    .meal-content {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .ingredients-section,
    .preparation-section {
        order: unset;
        grid-column: 1;
        border-right: 3px solid #4ECDC4;
        border-bottom: 3px solid #4ECDC4;
        border-left: none;
        border-top: none;
        padding: 5px;
    }

    .preparation-section {
        border-right: 3px solid #FF6B6B;
        border-top: 3px solid #FF6B6B;
        border-bottom: none;
    }

    .meal-title {
        font-size: 20px;
        color: chartreuse;
    }

    main {
        padding: 10px;
        margin: 0 5px 20px 5px;
    }
}

       .health-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.85);
    color: #ffcc00;
    font-size: 2.5em;
    font-weight: bold;
    padding: 25px 50px;
    border-radius: 20px;
    animation: fadeInOut 3s ease-in-out;
    z-index: 10000;
    text-align: center;
    border: 3px solid #ffcc00;
    box-shadow: 0 0 30px rgba(255, 204, 0, 0.5);
}

@keyframes fadeInOut {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
    50% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
}
    </style>
</head>

<body>
   <div id="splash-screen-container" class="fixed inset-0 flex items-center justify-center z-50">
</div>
      
    <div class="clock">
        <span id="timeDisplay">19:29:12</span>
    </div>

    <header>
        <h1>👩‍🍳 شو عاملي أكل؟👩‍🍳</h1>
    </header> 
    <main>
        <div id="languageSwitcherContainer" class="lang-switcher-row">
    <button class="lang-btn active" data-lang="ar">عربي</button>
    <button class="lang-btn" data-lang="en">English</button>
    <button class="lang-btn" data-lang="fa">فارسی</button>
    <button class="lang-btn" data-lang="ru">Русский</button>
</div>

        <div class="filters">
            <label for="healthStatus">الحالة الصحية:</label>
            <select id="healthStatus">
                <option value="normal">طبيعية</option>
                <option value="diet">سكري</option>
                <option value="pressure">ضغط</option>
                <option value="heart" selected> امراض قلبية</option>
            </select>

            <label for="cost">الكلفة:</label>
            <select id="cost">
                <option value="High">عالية</option>
                <option value="medium" >متوسطة</option>
                <option value="low" selected>منخفضة</option>
            </select>

            <label for="mealTime">وقت الوجبة:</label>
            <select id="mealTime">
                <option value="breakfast">فطور</option>
                <option value="lunch" selected>غداء</option>
                <option value="dinner">عشاء</option>
            </select>

            <label for="weather">حالة الطقس:</label>
            <select id="weather">
                <option value="cold">بارد</option> 
                <option value="moderate" selected>معتدل</option>
                <option value="hot">حار</option>
            </select>

            <label for="mealType">نوع الوجبة:</label>
            <select id="mealType">
                <option value="fast food" selected>وجبة سريعة</option>
                <option value="regular meal">وجبة عادية</option>
            </select>

            <label for="numberOfpeople">عدد الافراد:</label>
                <select id="numberOfpeople">
                <option value="small" selected>1 - 2</option>
                <option value="medium">3 - 4</option>
                <option value="large">5 - 6</option>
                <option value="xlarge">7 - 8</option>
                <option value="xxlarge">9 - 11</option>
                <option value="max">12+</option>
            </select>
        </div>

        <div id="result">
            <div class="no-preparation"> حددي الخيارات التي تناسبكِ  من القائمة  </div>
        </div>

        <button id="suggestBtn"> اضغطي  هنا  لاقترح   عليكِ  وجبة  </button>

        <div class="buttons-container">
            <!-- تمت إضافة تنسيق مبدئي لزر الخروج -->
            <button id="alternativeBtn">ابحث عن وجبة بديلة</button>
            <button id="exitBtn" style="background: linear-gradient(to right, #f01c04, #d71c07); color: rgb(2, 1, 15);">خروج</button>
            <button id="confirmBtn">موافقة على الوجبة</button>

        </div>
    </main>
    <script>

      // ====================================================================
      // 1. كائن الترجمة المركزي (Central Translations Object)
      // ====================================================================
   
    const translations = {

       ar: {
        dir: 'rtl',
        title: '👩‍🍳شو عاملي أكل؟ 👩‍🍳',
        suggestBtn: 'اضغطي هنا لاقترح عليك وجبة',
        altBtn: 'ابحث عن وجبة بديلة',
        confirmBtn: 'موافقة على الوجبة',
        exitBtn: 'خروج',
        confirmMsg: '✅ تم اختيار الوصفة بنجاح!',
        healthLabel: 'الحالة الصحية',
        costLabel: 'الكلفة',
        timeLabel: 'وقت الوجبة',
        weatherLabel: 'حالة الطقس',
        typeLabel: 'نوع الوجبة',
        peopleLabel: 'عدد الأفراد',
        preparationLabel: 'طريقة التحضير',
        ingredientsLabel: "المكونات",
        health: ['طبيعية', 'سكري', 'ضغط', 'امراض قلبية'],
        cost: ['عالية', 'متوسطة', 'منخفضة'],
        time: ['فطور', 'غداء', 'عشاء'],
        weather: ['بارد', 'معتدل', 'حار'],
        type: ['وجبة سريعة', 'وجبة عادية'],
        people: ['1 - 2', '3 - 4', '5 - 6', '7 - 8', '9 - 11', '12+'],
        noPrepMsg: 'حددي الخيارات التي تناسبكِ من القائمة',
        instructionsLabel: 'طريقة التحضير',

        // 🔑 1. الوحدات الأساسية
        units: {
            'g': 'غرام', 'kg': 'كغ', 'L': 'لتر', 'ml': 'مل',
            'cup': 'كوب', 'tbsp': 'ملعقة كبيرة', 'tsp': 'ملعقة صغيرة',
            'count': 'العدد', 'loaf': 'رغيف','clove': 'حص',
            'pinch': 'رشة', 'squeeze': 'عصرة', 'piece': 'حبة'
        },

        // 🔑 2. المقادير والروابط اللغوية
        quantifiers: {
            FRACTION_HALF: 'نصف',
            FRACTION_QUARTER: 'ربع',
            FRACTION_THIRD: 'ثلث',
            FRACTION_TWO_THIRDS: 'ثلثين',
            FRACTION_THREE_QUARTERS: 'ثلاثة أرباع',
            CONNECTOR_AND: ' و ',
            TEXT_TO_TASTE: 'حسب الطلب',
            TEXT_APPROX: 'تقريباً',
            TEXT_UNIT_AND_HALF: 'ونصف',
            TEXT_UNIT_ONE: 'واحدة',
            TEXT_UNIT_ONE_MASC: 'واحد',
            TEXT_UNIT_AND_QUARTER: 'وربع',
            TEXT_UNIT_AND_TWO_THIRDS: 'وثلثين',
        },  TEXT_UNIT_AND_THREE_QUARTERS: 'وثلاثة أرباع',

        // 🔑 3. الصفات والمعدودات
        descriptors: {
            MEDIUM: 'متوسطة',
            SMALL: 'صغيرة',
            LARGE: 'كبيرة',
            HEAD: 'رأس',
            CLOVE: 'حص',
            BUNCH: 'حزمة',
        },
    },

    // ====================================================================================
    // --- 2. اللغة الإنجليزية (en) ---
    // ====================================================================================
    en: {
        dir: 'ltr',
        title: '👩‍🍳 ?What are you cooking 👩‍🍳',
        suggestBtn: 'Click here to suggest a meal', 
        altBtn: 'Find an alternative meal', 
        confirmBtn: 'Confirm meal selection', 
        exitBtn: 'Exit',
        confirmMsg: '✅ Recipe successfully selected!',
        healthLabel: 'Health Status', 
        costLabel: 'Cost', 
        timeLabel: 'Meal Time', 
        weatherLabel: 'Weather Condition', 
        typeLabel: 'Meal Type', 
        peopleLabel: 'Number of People', 
        preparationLabel: 'Preparation Method', 
        ingredientsLabel: "Ingredients",
        health: ['Normal', 'Diabetes', 'Blood Pressure', 'Heart Conditions'], 
        cost: ['High', 'Medium', 'Low'], 
        time: ['Breakfast', 'Lunch', 'Dinner'], 
        weather: ['Cold', 'Moderate', 'Hot'], 
        type: ['Quick Meal', 'Regular Meal'], 
        people: ['1 - 2', '3 - 4', '5 - 6', '7 - 8', '9 - 11', '12+'], 
        noPrepMsg: 'Select the options that suit you from the menu',
        instructionsLabel: 'Preparation Method',

        // 🔑 1. الوحدات الأساسية
        units: {
            'g': 'g', 'kg': 'kg', 'L': 'L', 'ml': 'ml',
            'cup': 'cup', 'tbsp': 'tbsp', 'tsp': 'tsp',
            'count': 'count', 'loaf': 'loaf', 'clove': 'clove',
            'pinch': 'pinch', 'squeeze': 'squeeze', 'piece': 'piece'
        },

        // 🔑 2. المقادير والروابط اللغوية
        quantifiers: {
            FRACTION_HALF: 'half',
            FRACTION_QUARTER: 'quarter',
            FRACTION_THIRD: 'third',
            FRACTION_TWO_THIRDS: 'two-thirds',
            FRACTION_THREE_QUARTERS: 'three-quarters',
            CONNECTOR_AND: ' and ', 
            TEXT_TO_TASTE: 'to taste',
            TEXT_APPROX: 'approx',
            TEXT_UNIT_AND_HALF: ' and a half', 
            TEXT_UNIT_ONE: 'one', 
            TEXT_UNIT_ONE_MASC: 'one', 
            TEXT_UNIT_AND_QUARTER: ' and a quarter',
            TEXT_UNIT_AND_TWO_THIRDS: ' and two-thirds', 
            TEXT_UNIT_AND_THREE_QUARTERS: ' and three-quarters',
        },
        
        // 🔑 3. الصفات والمعدودات
        descriptors: {
            MEDIUM: 'medium',
            SMALL: 'small',
            LARGE: 'large',
            HEAD: 'head', 
            CLOVE: 'clove', 
            BUNCH: 'bunch', 
        },

        // 🔑 4. العبارات الكاملة
    phrases: {

        // ═══════════════════════════════════════════════════════════
        // ملعقة صغيرة (teaspoon)
        // ═══════════════════════════════════════════════════════════
        "ربع ملعقة صغيرة": "¼ teaspoon",
        "نصف ملعقة صغيرة": "½ teaspoon",
        "ثلاثة أرباع ملعقة صغيرة": "¾ teaspoon",
        "ملعقة صغيرة": "1 teaspoon",
        "ملعقة صغيرة ونصف": "1½ teaspoons",
        "ملعقة صغيرة وربع": "1¼ teaspoons",
        "ملعقتان صغيرتان": "2 teaspoons",
        "ملعقتان صغيرتان ونصف": "2½ teaspoons",
        "3 ملاعق صغيرة": "3 teaspoons",
        "4 ملاعق صغيرة": "4 teaspoons",
        "5 ملاعق صغيرة": "5 teaspoons",
        "6 ملاعق صغيرة": "6 teaspoons",

        // ═══════════════════════════════════════════════════════════
        // ملعقة كبيرة (tablespoon)
        // ═══════════════════════════════════════════════════════════
        "ربع ملعقة كبيرة": "¼ tablespoon",
        "نصف ملعقة كبيرة": "½ tablespoon",
        "ثلاثة أرباع ملعقة كبيرة": "¾ tablespoon",
        "ملعقة كبيرة": "1 tablespoon",
        "ملعقة كبيرة ونصف": "1½ tablespoons",
        "ملعقة كبيرة وربع": "1¼ tablespoons",
        "ملعقتان كبيرتان": "2 tablespoons",
        "ملعقتان كبيرتان ونصف": "2½ tablespoons",
        "3 ملاعق كبيرة": "3 tablespoons",
        "4 ملاعق كبيرة": "4 tablespoons",
        "5 ملاعق كبيرة": "5 tablespoons",
        "6 ملاعق كبيرة": "6 tablespoons",

        // ═══════════════════════════════════════════════════════════
        // كوب (cup)
        // ═══════════════════════════════════════════════════════════
        "ربع كوب": "¼ cup",
        "ثلث كوب": "⅓ cup",
        "نصف كوب": "½ cup",
        "ثلثا كوب": "⅔ cup",
        "ثلاثة أرباع كوب": "¾ cup",
        "كوب": "1 cup",
        "كوب ونصف": "1½ cups",
        "كوب وربع": "1¼ cups",
        "كوبان": "2 cups",
        "كوبان ونصف": "2½ cups",
        "3 أكواب": "3 cups",
        "4 أكواب": "4 cups",
        "5 أكواب": "5 cups",

        // ═══════════════════════════════════════════════════════════
        // حبة/قطعة (piece)
        // ═══════════════════════════════════════════════════════════
        "ربع حبة": "¼ piece",
        "نصف حبة": "½ piece",
        "ثلاثة أرباع حبة": "¾ piece",
        "حبة": "1 piece",
        "حبة ونصف": "1½ pieces",
        "حبتان": "2 pieces",
        "3 حبات": "3 pieces",
        "4 حبات": "4 pieces",
        "5 حبات": "5 pieces",
        "6 حبات": "6 pieces",
        "7 حبات": "7 pieces",
        "8 حبات": "8 pieces",
        "9 حبات": "9 pieces",
        "10 حبات": "10 pieces",

        // ═══════════════════════════════════════════════════════════
        // فص (clove) - للثوم
        // ═══════════════════════════════════════════════════════════
        "نصف فص": "½ clove",
        "فص": "1 clove",
        "فصان": "2 cloves",
        "3 فصوص": "3 cloves",
        "4 فصوص": "4 cloves",
        "5 فصوص": "5 cloves",
        "6 فصوص": "6 cloves",

        // ═══════════════════════════════════════════════════════════
        // رأس (head) - للثوم/البصل
        // ═══════════════════════════════════════════════════════════
        "ربع رأس": "¼ head",
        "نصف رأس": "½ head",
        "رأس": "1 head",
        "رأسان": "2 heads",
        "3 رؤوس": "3 heads",

        // ═══════════════════════════════════════════════════════════
        // حزمة/ربطة (bunch)
        // ═══════════════════════════════════════════════════════════
        "نصف حزمة": "½ bunch",
        "حزمة": "1 bunch",
        "حزمتان": "2 bunches",
        "نصف ربطة": "½ bunch",
        "ربطة": "1 bunch",

        // ═══════════════════════════════════════════════════════════
        // قرصة (pinch)
        // ═══════════════════════════════════════════════════════════
        "قرصة": "1 pinch",
        "قرصتان": "2 pinches",
        "3 قرصات": "3 pinches",

        // ═══════════════════════════════════════════════════════════
        // الأوزان والحجوم
        // ═══════════════════════════════════════════════════════════
        "غرام": "g",
        "جرام": "g",
        "غراماً": "g",
        "جراماً": "g",
        "مل": "ml",
        "مللتر": "ml",
        "ربع لتر": "¼ liter",
        "نصف لتر": "½ liter",
        "لتر": "1 liter",
        "لتر ونصف": "1½ liters",
        "لتران": "2 liters",
        "ربع كيلو": "250g",
        "نصف كيلو": "500g",
        "كيلو": "1 kg",
        "كيلو ونصف": "1.5 kg",

        // ═══════════════════════════════════════════════════════════
        // عبارات خاصة
        // ═══════════════════════════════════════════════════════════
        "حسب الرغبة": "to taste",
        "حسب الطلب": "to taste",
        "للتزيين": "for garnish",
        "حسب الحاجة": "as needed",
    },
},


    // ====================================================================================
    // --- 3. اللغة الروسية (ru) ---
    // ====================================================================================
    ru: {
        dir: 'ltr',
        title: '👩‍🍳 ?Что приготовим 👩‍🍳',
        suggestBtn: 'Нажми, чтобы предложить блюдо', 
        altBtn: 'Найти альтернативное блюдо', 
        confirmBtn: 'Подтвердить выбор', 
        exitBtn: 'Выход', 
        confirmMsg: '✅ Рецепт успешно выбран!', 
        healthLabel: 'Состояние здоровья', 
        costLabel: 'Стоимость', 
        timeLabel: 'Время приёма пищи', 
        weatherLabel: 'Погода', 
        typeLabel: 'Тип блюда', 
        peopleLabel: 'Количество персон', 
        preparationLabel: 'Способ приготовления', 
        ingredientsLabel: "Ингредиенты",
        health: ['Нормальное', 'Диабет', 'Давление', 'Сердечные заболевания'], 
        cost: ['Высокая', 'Средняя', 'Низкая'], 
        time: ['Завтрак', 'Обед', 'Ужин'], 
        weather: ['Холодная', 'Умеренная', 'Жаркая'], 
        type: ['Быстрое блюдо', 'Обычное блюдо'], 
        people: ['1-2', '3-4', '5-6', '7-8', '9-11', '12+'], 
        noPrepMsg: 'Выберите подходящие опции из списка',
        instructionsLabel: 'Способ приготовления',

        // 🔑 1. الوحدات الأساسية
        units: {
            'g': 'г', 'kg': 'кг', 'L': 'л', 'ml': 'мл',
            'cup': 'чашка', 'tbsp': 'ст. ложка', 'tsp': 'ч. ложка',
            'count': 'количество', 'loaf': 'ломтик', 'clove' :'зубчик',
            'pinch': 'щепотка', 'squeeze': 'выдавливание', 'piece': 'штука'
        },

        // 🔑 2. المقادير والروابط اللغوية
        quantifiers: {
            FRACTION_HALF: 'половина',
            FRACTION_QUARTER: 'четверть',
            FRACTION_THIRD: 'треть',
            FRACTION_TWO_THIRDS: 'две трети',
            FRACTION_THREE_QUARTERS: 'три четверти',
            CONNECTOR_AND: ' и ', 
            TEXT_TO_TASTE: 'по вкусу',
            TEXT_APPROX: 'примерно',
            TEXT_UNIT_AND_HALF: ' и половина', 
            TEXT_UNIT_ONE: 'одна',
            TEXT_UNIT_ONE_MASC: 'один',
            TEXT_UNIT_AND_QUARTER: ' и четверть',
            TEXT_UNIT_AND_THREE_QUARTERS: ' и три четверти',
            TEXT_UNIT_AND_TWO_THIRDS: ' и две трети',
        },

        // 🔑 3. الصفات والمعدودات
        descriptors: {
            MEDIUM: 'средняя',
            SMALL: 'маленькая',
            LARGE: 'большая',
            HEAD: 'головка', 
            CLOVE: 'зубчик', 
            BUNCH: 'пучок',
        },

        phrases: {

        // ═══════════════════════════════════════════════════════════
        // ملعقة صغيرة (чайная ложка) - مؤنث
        // ═══════════════════════════════════════════════════════════
        "ربع ملعقة صغيرة": "четверть чайной ложки",
        "نصف ملعقة صغيرة": "половина чайной ложки",
        "ثلاثة أرباع ملعقة صغيرة": "три четверти чайной ложки",
        "ملعقة صغيرة": "одна чайная ложка",
        "ملعقة صغيرة ونصف": "полторы чайные ложки",
        "ملعقة صغيرة وربع": "одна с четвертью чайная ложка",
        "ملعقتان صغيرتان": "две чайные ложки",
        "ملعقتان صغيرتان ونصف": "две с половиной чайные ложки",
        "3 ملاعق صغيرة": "три чайные ложки",
        "4 ملاعق صغيرة": "четыре чайные ложки",
        "5 ملاعق صغيرة": "пять чайных ложек",
        "6 ملاعق صغيرة": "шесть чайных ложек",

        // ═══════════════════════════════════════════════════════════
        // ملعقة كبيرة (столовая ложка) - مؤنث
        // ═══════════════════════════════════════════════════════════
        "ربع ملعقة كبيرة": "четверть столовой ложки",
        "نصف ملعقة كبيرة": "половина столовой ложки",
        "ثلاثة أرباع ملعقة كبيرة": "три четверти столовой ложки",
        "ملعقة كبيرة": "одна столовая ложка",
        "ملعقة كبيرة ونصف": "полторы столовые ложки",
        "ملعقة كبيرة وربع": "одна с четвертью столовая ложка",
        "ملعقتان كبيرتان": "две столовые ложки",
        "ملعقتان كبيرتان ونصف": "две с половиной столовые ложки",
        "3 ملاعق كبيرة": "три столовые ложки",
        "4 ملاعق كبيرة": "четыре столовые ложки",
        "5 ملاعق كبيرة": "пять столовых ложек",
        "6 ملاعق كبيرة": "шесть столовых ложек",

        // ═══════════════════════════════════════════════════════════
        // كوب (стакан) - مذكر
        // ═══════════════════════════════════════════════════════════
        "ربع كوب": "четверть стакана",
        "ثلث كوب": "треть стакана",
        "نصف كوب": "половина стакана",
        "ثلثا كوب": "две трети стакана",
        "ثلاثة أرباع كوب": "три четверти стакана",
        "كوب": "один стакан",
        "كوب ونصف": "полтора стакана",
        "كوب وربع": "один с четвертью стакан",
        "كوبان": "два стакана",
        "كوبان ونصف": "два с половиной стакана",
        "3 أكواب": "три стакана",
        "4 أكواب": "четыре стакана",
        "5 أكواب": "пять стаканов",

        // ═══════════════════════════════════════════════════════════
        // حبة/قطعة (штука) - مؤنث
        // ═══════════════════════════════════════════════════════════
        "ربع حبة": "четверть штуки",
        "نصف حبة": "половина штуки",
        "ثلاثة أرباع حبة": "три четверти штуки",
        "حبة": "одна штука",
        "حبة ونصف": "полторы штуки",
        "حبتان": "две штуки",
        "3 حبات": "три штуки",
        "4 حبات": "четыре штуки",
        "5 حبات": "пять штук",
        "6 حبات": "шесть штук",
        "7 حبات": "семь штук",
        "8 حبات": "восемь штук",
        "9 حبات": "девять штук",
        "10 حبات": "десять штук",

        // ═══════════════════════════════════════════════════════════
        // فص (зубчик) - مذكر (للثوم)
        // ═══════════════════════════════════════════════════════════
        "نصف فص": "половина зубчика",
        "فص": "один зубчик",
        "فصان": "два зубчика",
        "3 فصوص": "три зубчика",
        "4 فصوص": "четыре зубчика",
        "5 فصوص": "пять зубчиков",
        "6 فصوص": "шесть зубчиков",

        // ═══════════════════════════════════════════════════════════
        // رأس (головка) - مؤنث (للثوم/البصل)
        // ═══════════════════════════════════════════════════════════
        "ربع رأس": "четверть головки",
        "نصف رأس": "половина головки",
        "رأس": "одна головка",
        "رأسان": "две головки",
        "3 رؤوس": "три головки",

        // ═══════════════════════════════════════════════════════════
        // حزمة/ربطة (пучок) - مذكر
        // ═══════════════════════════════════════════════════════════
        "نصف حزمة": "половина пучка",
        "حزمة": "один пучок",
        "حزمتان": "два пучка",
        "نصف ربطة": "половина пучка",
        "ربطة": "один пучок",

        // ═══════════════════════════════════════════════════════════
        // قرصة (щепотка) - مؤنث
        // ═══════════════════════════════════════════════════════════
        "قرصة": "одна щепотка",
        "قرصتان": "две щепотки",
        "3 قرصات": "три щепотки",

        // ═══════════════════════════════════════════════════════════
        // غرام (грамм) - مذكر
        // ═══════════════════════════════════════════════════════════
        "غرام": "г",
        "جرام": "г",
        "غراماً": "г",
        "جراماً": "г",

        // ═══════════════════════════════════════════════════════════
        // مل (мл) - بدون تصريف
        // ═══════════════════════════════════════════════════════════
        "مل": "мл",
        "مللتر": "мл",

        // ═══════════════════════════════════════════════════════════
        // لتر (литр) - مذكر
        // ═══════════════════════════════════════════════════════════
        "ربع لتر": "четверть литра",
        "نصف لتر": "половина литра",
        "لتر": "один литр",
        "لتر ونصف": "полтора литра",
        "لتران": "два литра",

        // ═══════════════════════════════════════════════════════════
        // كغ (кг) - بدون تصريف عادةً
        // ═══════════════════════════════════════════════════════════
        "ربع كيلو": "четверть кг",
        "نصف كيلو": "половина кг",
        "كيلو": "один кг",
        "كيلو ونصف": "полтора кг",

        // ═══════════════════════════════════════════════════════════
        // عبارات خاصة
        // ═══════════════════════════════════════════════════════════
        "حسب الرغبة": "по вкусу",
        "حسب الطلب": "по вкусу",
        "للتزيين": "для украшения",
        "حسب الحاجة": "по необходимости",
    },
},


    // ====================================================================================
    // --- 4. اللغة الفارسية (fa) ---
    // ====================================================================================
    fa: { 
        dir: 'rtl', 
        title: '👩‍🍳چی می‌پزی؟ 👩‍🍳', 
        suggestBtn: 'برای پیشنهاد غذا اینجا کلیک کنید', 
        altBtn: 'یافتن غذای جایگزین', 
        confirmBtn: 'تأیید انتخاب غذا', 
        exitBtn: 'خروج', 
        confirmMsg: '✅ دستور پخت با موفقیت انتخاب شد!', 
        healthLabel: 'وضعیت سلامتی', 
        costLabel: 'هزینه', 
        timeLabel: 'زمان وعده غذایی', 
        weatherLabel: 'وضعیت آب و هوا', 
        typeLabel: 'نوع غذا', 
        peopleLabel: 'تعداد افراد', 
        preparationLabel: 'روش آماده‌سازی', 
        ingredientsLabel: "مواد لازم",
        health: ['عادی', 'دیابت', 'فشار خون', 'مشکلات قلبی'], 
        cost: ['بالا', 'متوسط', 'کم'], 
        time: ['صبحانه', 'ناهار', 'شام'], 
        weather: ['سرد', 'ملایم', 'گرم'], 
        type: ['غذای فوری', 'غذای معمولی'], 
        people: ['1 - 2', '3 - 4', '5 - 6', '7 - 8', '9 - 11', '12+'], 
        noPrepMsg: 'گزینه‌هایی را که برای شما مناسب است از منو انتخاب کنید',
        instructionsLabel: 'روش آماده‌سازی',

        // 🔑 1. الوحدات الأساسية
        units: {
            'g': 'گرم', 'kg': 'کیلوگرم', 'L': 'لیتر', 'ml': 'میلی‌لیتر', 'clove':'میخک',
            'cup': 'پیمانه', 'tbsp': 'قاشق غذاخوری', 'tsp': 'قاشق چای‌خوری',
            'count': 'تعداد', 'loaf': 'قرص',  'slice': 'برش', 'dash': 'کمی',
            'pinch': 'پینچ', 'squeeze': 'عصاره', 'piece': 'عدد', 'to_taste': 'به میزان لازم' 
        },

        // 🔑 2. المقادير والروابط اللغوية
        quantifiers: {
            FRACTION_HALF: 'نصف',
            FRACTION_QUARTER: 'یک چهارم',
            FRACTION_THIRD: 'یک سوم',
            FRACTION_TWO_THIRDS: 'دو سوم',
            FRACTION_THREE_QUARTERS: 'سه چهارم',
            CONNECTOR_AND: ' و ', 
            TEXT_TO_TASTE: 'به میزان لازم',
            TEXT_APPROX: 'تقریباً',
            TEXT_UNIT_AND_HALF: ' و نیم', 
            TEXT_UNIT_ONE: 'یک عدد', 
            TEXT_UNIT_ONE_MASC: 'یک', 
            TEXT_UNIT_AND_QUARTER: ' و یک چهارم', 
        },
        
        // 🔑 3. الصفات والمعدودات
        descriptors: {
            MEDIUM: 'متوسط',
            SMALL: 'کوچک',
            LARGE: 'بزرگ',
            HEAD: 'سَر', 
            CLOVE: 'حبه', 
            BUNCH: 'دسته', 
        },

        // 🔑 4. العبارات الكاملة
    phrases: {

        // ═══════════════════════════════════════════════════════════
        // ملعقة صغيرة (قاشق چایخوری)
        // ═══════════════════════════════════════════════════════════
        "ربع ملعقة صغيرة": "یک چهارم قاشق چایخوری",
        "نصف ملعقة صغيرة": "نیم قاشق چایخوری",
        "ثلاثة أرباع ملعقة صغيرة": "سه چهارم قاشق چایخوری",
        "ملعقة صغيرة": "یک قاشق چایخوری",
        "ملعقة صغيرة ونصف": "یک و نیم قاشق چایخوری",
        "ملعقة صغيرة وربع": "یک و یک چهارم قاشق چایخوری",
        "ملعقتان صغيرتان": "دو قاشق چایخوری",
        "ملعقتان صغيرتان ونصف": "دو و نیم قاشق چایخوری",
        "3 ملاعق صغيرة": "سه قاشق چایخوری",
        "4 ملاعق صغيرة": "چهار قاشق چایخوری",
        "5 ملاعق صغيرة": "پنج قاشق چایخوری",
        "6 ملاعق صغيرة": "شش قاشق چایخوری",

        // ═══════════════════════════════════════════════════════════
        // ملعقة كبيرة (قاشق غذاخوری)
        // ═══════════════════════════════════════════════════════════
        "ربع ملعقة كبيرة": "یک چهارم قاشق غذاخوری",
        "نصف ملعقة كبيرة": "نیم قاشق غذاخوری",
        "ثلاثة أرباع ملعقة كبيرة": "سه چهارم قاشق غذاخوری",
        "ملعقة كبيرة": "یک قاشق غذاخوری",
        "ملعقة كبيرة ونصف": "یک و نیم قاشق غذاخوری",
        "ملعقة كبيرة وربع": "یک و یک چهارم قاشق غذاخوری",
        "ملعقتان كبيرتان": "دو قاشق غذاخوری",
        "ملعقتان كبيرتان ونصف": "دو و نیم قاشق غذاخوری",
        "3 ملاعق كبيرة": "سه قاشق غذاخوری",
        "4 ملاعق كبيرة": "چهار قاشق غذاخوری",
        "5 ملاعق كبيرة": "پنج قاشق غذاخوری",
        "6 ملاعق كبيرة": "شش قاشق غذاخوری",

        // ═══════════════════════════════════════════════════════════
        // كوب (لیوان)
        // ═══════════════════════════════════════════════════════════
        "ربع كوب": "یک چهارم لیوان",
        "ثلث كوب": "یک سوم لیوان",
        "نصف كوب": "نیم لیوان",
        "ثلثا كوب": "دو سوم لیوان",
        "ثلاثة أرباع كوب": "سه چهارم لیوان",
        "كوب": "یک لیوان",
        "كوب ونصف": "یک و نیم لیوان",
        "كوب وربع": "یک و یک چهارم لیوان",
        "كوبان": "دو لیوان",
        "كوبان ونصف": "دو و نیم لیوان",
        "3 أكواب": "سه لیوان",
        "4 أكواب": "چهار لیوان",
        "5 أكواب": "پنج لیوان",

        // ═══════════════════════════════════════════════════════════
        // حبة/قطعة (عدد)
        // ═══════════════════════════════════════════════════════════
        "ربع حبة": "یک چهارم عدد",
        "نصف حبة": "نیم عدد",
        "ثلاثة أرباع حبة": "سه چهارم عدد",
        "حبة": "یک عدد",
        "حبة ونصف": "یک و نیم عدد",
        "حبتان": "دو عدد",
        "3 حبات": "سه عدد",
        "4 حبات": "چهار عدد",
        "5 حبات": "پنج عدد",
        "6 حبات": "شش عدد",
        "7 حبات": "هفت عدد",
        "8 حبات": "هشت عدد",
        "9 حبات": "نه عدد",
        "10 حبات": "ده عدد",

        // ═══════════════════════════════════════════════════════════
        // فص (حبه) - للثوم
        // ═══════════════════════════════════════════════════════════
        "نصف فص": "نیم حبه",
        "فص": "یک حبه",
        "فصان": "دو حبه",
        "3 فصوص": "سه حبه",
        "4 فصوص": "چهار حبه",
        "5 فصوص": "پنج حبه",
        "6 فصوص": "شش حبه",

        // ═══════════════════════════════════════════════════════════
        // رأس (سر/بوته)
        // ═══════════════════════════════════════════════════════════
        "ربع رأس": "یک چهارم بوته",
        "نصف رأس": "نیم بوته",
        "رأس": "یک بوته",
        "رأسان": "دو بوته",
        "3 رؤوس": "سه بوته",

        // ═══════════════════════════════════════════════════════════
        // حزمة/ربطة (دسته)
        // ═══════════════════════════════════════════════════════════
        "نصف حزمة": "نیم دسته",
        "حزمة": "یک دسته",
        "حزمتان": "دو دسته",
        "نصف ربطة": "نیم دسته",
        "ربطة": "یک دسته",

        // ═══════════════════════════════════════════════════════════
        // قرصة (نوک انگشت)
        // ═══════════════════════════════════════════════════════════
        "قرصة": "یک نوک انگشت",
        "قرصتان": "دو نوک انگشت",
        "3 قرصات": "سه نوک انگشت",

        // ═══════════════════════════════════════════════════════════
        // الأوزان والحجوم
        // ═══════════════════════════════════════════════════════════
        "غرام": "گرم",
        "جرام": "گرم",
        "غراماً": "گرم",
        "جراماً": "گرم",
        "مل": "میلی‌لیتر",
        "مللتر": "میلی‌لیتر",
        "ربع لتر": "یک چهارم لیتر",
        "نصف لتر": "نیم لیتر",
        "لتر": "یک لیتر",
        "لتر ونصف": "یک و نیم لیتر",
        "لتران": "دو لیتر",
        "ربع كيلو": "۲۵۰ گرم",
        "نصف كيلو": "۵۰۰ گرم",
        "كيلو": "یک کیلو",
        "كيلو ونصف": "یک و نیم کیلو",

        // ═══════════════════════════════════════════════════════════
        // عبارات خاصة
        // ═══════════════════════════════════════════════════════════
        "حسب الرغبة": "به میزان دلخواه",
        "حسب الطلب": "به میزان دلخواه",
        "للتزيين": "برای تزیین",
        "حسب الحاجة": "به اندازه نیاز",
    },
},

};
// ====================================================================
// 2. دوال مساعدة للغة والواجهة (UI Helpers)
// ====================================================================

/**
 * دالة تحديث مظهر الزر النشط (الإضاءة).
 * @param {string} activeLangCode كود اللغة النشط.
 */
function highlightActiveLanguageButton(activeLangCode) {
    const langButtons = document.querySelectorAll('.lang-btn');
    
    langButtons.forEach(button => {
        button.classList.remove('active'); 
        if (button.getAttribute('data-lang') === activeLangCode) {
            button.classList.add('active');
        }
    });
}

/**
 * دالة تطبيق الترجمة الموحدة على عناصر الواجهة.
 * @param {string} langCode كود اللغة المراد تطبيقه.
 */
function applyUITranslation(langCode) {
    const t = translations[langCode];
    if (!t) return;
    
    // 1. تحديث الاتجاه الأساسي والـ Class
    document.documentElement.setAttribute('lang', langCode);
    document.documentElement.setAttribute('dir', t.dir);
    document.body.className = t.dir === 'rtl' ? 'rtl-mode' : 'ltr-mode'; 
    document.title = t.title;

    const headerTitle = document.querySelector('header h1');
    if (headerTitle) { headerTitle.textContent = t.title; }

    // 2. تحديث نصوص الأزرار والمناطق الثابتة
    const elementsToUpdate = {
        '#suggestBtn': t.suggestBtn,
        '#alternativeBtn': t.altBtn,
        '#confirmBtn': t.confirmBtn,
        '#exitBtn': t.exitBtn,
        '#confirmationMsg': t.confirmMsg,
        '#no-preparation': t.noPrepMsg 
    };

    for (const selector in elementsToUpdate) {
        const element = document.querySelector(selector);
        if (element) {
            element.textContent = elementsToUpdate[selector];
        }
    }

    // 3. تحديث تسميات حقول الإدخال (Labels)
    const labelMap = {
        'healthStatus': t.healthLabel,
        'cost': t.costLabel,
        'mealTime': t.timeLabel,
        'weather': t.weatherLabel,
        'mealType': t.typeLabel,
        'numberOfpeople': t.peopleLabel 
    };

    for (const id in labelMap) {
        const label = document.querySelector(`label[for="${id}"]`);
        if (label) { label.textContent = labelMap[id]; }
    }
    
    // 4. تحديث خيارات القوائم المنسدلة (Options Texts)
    const selectOptions = [
        { id: 'healthStatus', data: t.health },
        { id: 'cost', data: t.cost },
        { id: 'mealTime', data: t.time },
        { id: 'weather', data: t.weather },
        { id: 'mealType', data: t.type },
        { id: 'numberOfpeople', data: t.people }
    ];

    selectOptions.forEach(item => {
        const selectElement = document.getElementById(item.id);
        if (selectElement) {
            item.data.forEach((text, index) => {
                if (selectElement.options[index]) {
                    selectElement.options[index].textContent = text;
                }
            });
        }
    });

    // 5. تحديث لغة الساعة (إن وجدت)
    if (typeof updateClock === 'function') {
         updateClock();
    }
}
 </script>
<script src="mealsdatabase1.js"></script>
<script>
/**
 * تتحمل مسؤولية تبديل اللغة الفعلية في التطبيق وتطبيق التنسيقات.
 * @param {string} langCode كود اللغة الذي تم اختياره ('ar', 'en', 'ru', 'fa').
 */
function handleLanguageToggle(langCode) { 
    console.log(`--- بدء تتبع دالة handleLanguageToggle للغة: ${langCode} ---`);
    
    // 1. الحفظ في الذاكرة
    localStorage.setItem('preferredLang', langCode);
    console.log(`1. تم حفظ اللغة المفضلة: ${langCode}`);

    // 2. تحديد وتطبيق اتجاه الكتابة (LTR/RTL)
    const isRTL = (langCode === 'ar' || langCode === 'fa'); 
    document.documentElement.dir = isRTL ? 'rtl' : 'ltr';
    document.documentElement.lang = langCode;
    console.log(`2. تم تعيين اتجاه الكتابة إلى: ${document.documentElement.dir}`); // يعرض 'rtl' أو 'ltr'

    // 3. تطبيق الترجمة وتحديث الواجهة
    applyUITranslation(langCode); 
    console.log(`3. تم استدعاء applyUITranslation لتحديث الواجهة الثابتة.`);
    
    // 4. تفعيل الزر المُضاء
    highlightActiveLanguageButton(langCode);
    console.log('4. تم تظليل زر اللغة النشط.');

    // 5. إخفاء رسالة التأكيد
    const confirmationMsg = document.getElementById('confirmationMsg');
    if (confirmationMsg) { 
        confirmationMsg.style.display = 'none';
        console.log('5. تم إخفاء رسالة التأكيد.');
    }

    // 6. إعادة عرض الوجبة الحالية باللغة الجديدة
    if (window.currentSuggestedMeal) {
        console.log('6. الوجبة الحالية موجودة. سيتم استدعاء displayMeal...');
        displayMeal(window.currentSuggestedMeal);
        console.log('   تم استدعاء displayMeal بنجاح.');
    } else {
        console.log('6. لا توجد وجبة حالية. تحديث رسالة "لا نتائج"...');
        displayNoResults(false, true);
    }
    
    // 7. تحديث كود اللغة على وسم HTML
    document.documentElement.lang = langCode;
    console.log(`7. تم تعيين document.documentElement.lang إلى: ${document.documentElement.lang}`);
    
    console.log(`--- انتهاء تتبع دالة handleLanguageToggle ---`);
}

/**
 * دالة عرض رسالة "لا نتائج" (مُبقاة من الكود القديم).
 * @param {boolean} isAlternative هل الرسالة خاصة بالبدائل.
 * @param {boolean} isReset هل الرسالة هي رسالة البداية.
 */
function displayNoResults(isAlternative = false, isReset = false) {
    const resultDiv = document.getElementById('result');
    const currentLangCode = document.documentElement.lang; 

    const messages = {
        'ar': isReset ? '☝حددي  الخيارات التي تناسبكِ من القائمة👆 ' : (isAlternative ? 'عفواً، لا توجد وجبة بديلة تطابق المعايير المحددة.' : 'عفواً، لا توجد وجبات تطابق المعايير المحددة حالياً.'),
        'en': isReset ? "☝ Select the appropriate options from the list 👆" : (isAlternative ? 'Sorry, no alternative meal matches the specified criteria.' : 'Sorry, no meals currently match the specified criteria.'),
        'ru': isReset ? "☝ Выберите подходящие варианты из списка 👆" : (isAlternative ? 'К сожалению, альтернативное блюдо не соответствует указанным критериям.' : 'К сожалению, в настоящее время нет блюд, соответствующих указанным критериям.'),
        'fa': isReset ? " ☝ گزینههای مناسب را از لیست انتخاب کنید👆" : (isAlternative ? 'متأسفانه، غذای جایگزینی با معیارهای مشخص شده مطابقت ندارد.' : 'متأسفانه، در حال حاضر هیچ غذایی با معیارهای مشخص شده مطابقت ندارد.')
    };

    const message = messages[currentLangCode] || messages['ar'];

    resultDiv.innerHTML = `<div class="${isReset ? 'no-preparation' : 'no-results'}">${message}</div>`;
}

// ====================================================================
// 3. دوال منطق الوجبات (Meal Logic Helpers)
// ====================================================================

const suggestBtn = document.getElementById('suggestBtn');
const alternativeBtn = document.getElementById('alternativeBtn');
const confirmBtn = document.getElementById('confirmBtn');
const exitBtn = document.getElementById('exitBtn');

let lastSuggestedMeal = null; 

/**
 * يحدد عامل الضرب (المضاعف) بناءً على العدد المختار من قائمة المعايير.
 * @param {string} numberOfpeople القيمة المختارة من القائمة.
 * @returns {number} المضاعف الرقمي.
 */
function getQuantityMultiplier(numberOfpeople) {
    switch (numberOfpeople) {
        case 'small': return 0.5; // 1 - 2 شخص
        case 'medium': return 1; // 3 - 4 أشخاص (الأساس)
        case 'large': return 1.5; // 5 - 6 أشخاص
        case 'xlarge': return 2; // 7 - 8 أشخاص
        case 'xxlarge': return 2.5; // 9 - 11 أشخاص
        case 'max': return 3; // 12+ أشخاص
        default: return 1; 
    }
}

/**
 * تحول المقدار الرقمي إلى تعبير نصي عملي (1.5 -> كوب ونصف).
 * @param {number} quantity القيمة الرقمية المحسوبة.
 * @param {string} unitAr الوحدة العربية للمكون.
 * @returns {string} المقدار الجديد والوحدة النصية.
 */
/**
 * تتحقق مما إذا كانت الوحدة مؤنثة.
 * @param {string} unitAr الوحدة العربية.
 * @returns {boolean}
 */
function isUnitFeminine(unitAr) {
    // قائمة شائعة للوحدات المؤنثة
    const knownFeminine = ['قطعة', 'ملعقة', 'حبة', 'حزمة','مرة', 'وحدة']; 
    
    if (unitAr.endsWith('ة') || knownFeminine.includes(unitAr)) {
        return true;
    }
    return false;
}

/**
 * تحول المقدار الرقمي إلى تعبير نصي عملي (1.5 -> كوب ونصف).
 * (مُحدَّثة لدعم التأنيث والتذكير للنعت 'واحد')
 * * @param {number} quantity القيمة الرقمية المحسوبة.
 * @param {string} unitAr الوحدة العربية للمكون.
 * @returns {string} المقدار الجديد والوحدة النصية.
 */
function convertToPracticalText(quantity, unitAr) {
    console.log(`\n--- بدء المعالجة لكمية: ${quantity} ${unitAr} ---`);
    
    // 🛑 1. التحضير والقواعد الثابتة
    
    // دالة مساعدة للحصول على المفرد
    function getSingularForm(unit) {
        // 🚨 خطوة التنظيف الجديدة: إزالة "العدد" وأي رموز وأقواس
        let cleanedUnit = unit.replace(/العدد|\(|\)/g, '').trim();

        // الآن نطبق قواعد المفرد على الوحدة النظيفة
        if (cleanedUnit === 'حبات') return 'حبة';
        if (cleanedUnit === 'أكواب') return 'كوب';
        if (cleanedUnit === 'ملاعق كبيرة') return 'ملعقة كبيرة';
        if (cleanedUnit === 'ملاعق صغيرة') return 'ملعقة صغيرة';
        if (cleanedUnit.includes('أرغفة')) return cleanedUnit.replace('أرغفة', 'رغيف');
        
        // في حالة (رغيف)
        if (cleanedUnit.includes('رغيف') && cleanedUnit.length > 5) return 'رغيف';
        
        return cleanedUnit; // إذا لم يكن هناك تصريف، نرجع الوحدة النظيفة
    }

    const unitSingular = getSingularForm(unitAr); // الحصول على المفرد النظيف
    
    if (unitAr.includes('رشة') || unitAr === 'رشة') {
        return 'رشة حسب الطلب';
    }

    const adjectiveOne = isUnitFeminine(unitSingular) ? 'واحدة' : 'واحد';
    
    // دالة تصريف الوحدة (للجمع: 3 فأكثر)
    function getUnitForm(unit, count) { 
        if (count >= 3) { 
             if (unit === 'حبة') return 'حبات';
             if (unit === 'كوب') return 'أكواب';
             if (unit === 'ملعقة كبيرة') return 'ملاعق كبيرة'; 
             if (unit === 'ملعقة صغيرة') return 'ملاعق صغيرة';
             if (unit.includes('رغيف')) return unit.replace('(رغيف)', '(أرغفة)'); 
             if (unit.includes('حص')) return unit.replace('(حص)', '(حصوص)');
        }
        return unit; 
    }

    const fractionsMap = [
        { value: 0.25, text: 'ربع' }, { value: 0.5, text: 'نصف' }, 
        { value: 0.75, text: 'ثلاثة أرباع' }, { value: 0.33, text: 'ثلث' }, 
        { value: 0.66, text: 'ثلثين' }
    ];

    // 🛑 2. حالة كمية صغيرة جداً (رشة)
    if (unitSingular === 'ملعقة صغيرة' && quantity < 0.25) {
        return 'رشة حسب الطلب';
    }
    
    const integerPart = Math.floor(quantity);
    const fractionalPart = quantity - integerPart;

    let bestMatch = null;
    if (fractionalPart > 0.05) { 
        let minDiff = Infinity;
        fractionsMap.forEach(frac => {
            const diff = Math.abs(fractionalPart - frac.value);
            if (diff < minDiff) {
                minDiff = diff;
                bestMatch = frac;
            }
        });
    }

    console.log(`الجزء الصحيح: ${integerPart}, الكسر المقرب: ${bestMatch ? bestMatch.text : 'لا يوجد'}, الوحدة المفردة المُستخدمة: ${unitSingular}`);
    
    let resultText = '';
    
    // الوحدة التي يتم استخدامها مع الأعداد الصحيحة >= 3
    const unitForPluralCount = (integerPart >= 3) ? getUnitForm(unitSingular, 3) : unitSingular;
    
    // 3. بناء النص: التعامل مع الجزء الصحيح
    if (integerPart >= 1) {
        
        if (integerPart === 1) { 
            // حالة 1 أو 1.x: نبدأ بالرقم/الصفة ونعتمد على التنسيق النهائي
        } 
        else if (integerPart === 2) {
             // حالة 2 أو 2.x: المثنى أو 2 + المفرد
             if (unitSingular === 'حبة') {
                 resultText += `حبتان`;
             } else {
                 resultText += `${integerPart} ${unitSingular}`;
             }
        }
        else {
            // حالة 3 فما فوق: الرقم + الجمع المصرف
            resultText += `${integerPart} ${unitForPluralCount}`; 
        }
    } 

    console.log(`النص بعد معالجة الجزء الصحيح (${integerPart}): "${resultText}"`);
    
    // 4. بناء النص: التعامل مع الجزء الكسري
    if (bestMatch) {
        
        if (integerPart === 1) {
             // 🛑 حالة 1.x: الاختصار (حبة ونصف)
             resultText = `${unitSingular} و${bestMatch.text}`;
        }
        else if (integerPart === 2) {
             // حالة 2.x: حبتان ونصف / كوبان وربع
             let dualText = (unitSingular === 'حبة') ? 'حبتان' : `${integerPart} ${unitSingular}`;
             resultText = `${dualText} و${bestMatch.text}`;
        }
        else if (integerPart >= 3) {
            // حالة 3.x: الرقم + الجمع + و + الكسر
            resultText += ' و';
            resultText += `${bestMatch.text.replace('و', '')}`;
        } 
        else if (integerPart === 0) {
            // حالة 0.x: الكسر + المفرد (نصف ملعقة)
            resultText += `${bestMatch.text.replace('و', '')} ${unitSingular}`;
        }
        console.log(`النص بعد معالجة الكسر: "${resultText}"`);
    } 

    // 5. حالات الحصر (الأعداد الكاملة)
    if (resultText === '' && integerPart >= 1) {
        if (integerPart === 1) {
            resultText = `${unitSingular} ${adjectiveOne}`; // "حبة واحدة"
        }
        else if (integerPart === 2) {
             resultText = (unitSingular === 'حبة') ? 'حبتان' : `${integerPart} ${unitSingular}`; 
        }
        else {
            resultText = `${integerPart} ${unitForPluralCount}`;
        }
        console.log(`النص بعد معالجة الأعداد الكاملة: "${resultText}"`);
    }
    
    if (resultText === '' && integerPart === 0 && !bestMatch) {
        console.log('الكمية صفر.');
        return '';
    }

    // 6. الإخراج النهائي
    const finalOutput = resultText.trim().replace(/\s+/g, ' ');
    console.log(`الإخراج النهائي: "${finalOutput}"`);
    console.log(`----------------------------------`);
    return finalOutput;
}
// ═══════════════════════════════════════════════════════════════════════════════════════
// 🥚 قاموس مكونات البيض (غير قابلة للتقسيم)
// ═══════════════════════════════════════════════════════════════════════════════════════

const INDIVISIBLE_INGREDIENTS = [
    "بيض", "بيضة", "بيضات", "بيضتان", "بيضتين"
];

/**
 * يتحقق إذا كان المكون من البيض.
 * @param {string} ingredientName اسم المكون بالعربية.
 * @returns {boolean} true إذا كان بيض.
 */
function isEggIngredient(ingredientName) {
    if (!ingredientName) return false;

    return INDIVISIBLE_INGREDIENTS.some(egg => ingredientName.includes(egg));
}

// ═══════════════════════════════════════════════════════════════════════════════════════
// 📐 دالة الاحتساب المُعدَّلة
// ═══════════════════════════════════════════════════════════════════════════════════════

/**
 * تطبق الاحتساب على مقادير الوجبة بناءً على المضاعف، وتطبق قواعد التحويل النصي.
 * @param {object} meal الوجبة الأصلية (بكميات 4 أفراد).
 * @param {number} multiplier المضاعف المُعاد من getQuantityMultiplier().
 * @returns {object} نسخة جديدة من الوجبة تحتوي على الكميات المحتسبة.
 */
function calculateNewQuantities(meal, multiplier) {
    const TOAST_BREAD_WEIGHT_GRAMS = 35;

    if (multiplier === 1) {
        return meal;
    }

    const calculatedIngredients = meal.ingredients.map(ingredient => {
        let baseQuantity = ingredient.quantity;
        let baseUnit = ingredient.unit_ar;
        const ingredientName = ingredient.item_ar || "";

        // 1. تطبيق المضاعف
        let newQuantity = baseQuantity * multiplier;

        // 🥚 تدوير البيض للعدد الصحيح الأقرب (لا يقل عن 1)
        if (isEggIngredient(ingredientName)) {
            newQuantity = Math.max(1, Math.round(newQuantity));
        }

        // 🍞 التحقق من "خبز محمص" وتحويله
        if (ingredientName && ingredientName.includes('خبز محمص')) {
            let totalGrams = newQuantity;

            if (baseUnit === 'كغ' || baseUnit === 'كيلوغرام') {
                totalGrams *= 1000;
            }

            newQuantity = totalGrams / TOAST_BREAD_WEIGHT_GRAMS;
            baseUnit = 'العدد';
            baseUnit = `${baseUnit} (رغيف)`;
        }

        // 2. التحويل من "مل" إلى وحدات عملية أكبر
        if (baseUnit === 'مل' || baseUnit === 'مليلتر') {
            baseUnit = 'مل';

            if (newQuantity >= 1000) {
                newQuantity /= 1000;
                baseUnit = 'لتر';
            }
            else if (newQuantity >= 240) {
                newQuantity /= 240;
                baseUnit = 'كوب';
            }
            else if (newQuantity >= 15) {
                newQuantity /= 15;
                baseUnit = 'ملعقة كبيرة';
            }
            else if (newQuantity >= 5) {
                newQuantity /= 5;
                baseUnit = 'ملعقة صغيرة';
            }
        }

        // 3. التحويل من "كوب" إلى "لتر" إذا كانت الكمية كبيرة
        if (baseUnit === 'كوب' && newQuantity > 4) {
            newQuantity /= 4.166;
            baseUnit = 'لتر';
        }

        // 4. تطبيق التحويل النصي (الكسور والتقريب)
        // 🥚 لا نطبق الكسور على البيض
        const finalOutputText = isEggIngredient(ingredientName)
            ? null
            : convertToPracticalText(newQuantity, baseUnit);

        if (finalOutputText) {
             return {
                 ...ingredient,
                 unit_ar: baseUnit, 
                 quantity: finalOutputText
             };
        } else {
             const finalQuantity = Math.round(newQuantity * 100) / 100;
             return {
                 ...ingredient,
                 quantity: finalQuantity,
                 unit_ar: baseUnit
             };
        }
    });

    return {
        ...meal,
        ingredients: calculatedIngredients
    };
}

// ═══════════════════════════════════════════════════════════════════════════════════════
// 🔢 نظام الترجمة الحسابي للمقادير - الإصدار المُصحَّح V2
// ═══════════════════════════════════════════════════════════════════════════════════════

const QuantityTranslator = {

    // ═══════════════════════════════════════════════════════════════════════════════════
    // 📊 قاموس الكسور ← قيمتها العددية
    // ═══════════════════════════════════════════════════════════════════════════════════
    fractions: {
        "ربع": 0.25,
        "ثلث": 0.33,
        "نصف": 0.5,
        "ثلثا": 0.66,
        "ثلثي": 0.66,
        "ثلاثة أرباع": 0.75,
    },

    // ═══════════════════════════════════════════════════════════════════════════════════
    // 📊 الأعداد المكتوبة ← قيمتها
    // ═══════════════════════════════════════════════════════════════════════════════════
    arabicNumbers: {
        "واحد": 1, "واحدة": 1,
        "اثنان": 2, "اثنتان": 2, "اثنين": 2, "اثنتين": 2,
        "ثلاث": 3, "ثلاثة": 3,
        "أربع": 4, "أربعة": 4,
        "خمس": 5, "خمسة": 5,
        "ست": 6, "ستة": 6,
        "سبع": 7, "سبعة": 7,
        "ثماني": 8, "ثمان": 8, "ثمانية": 8,
        "تسع": 9, "تسعة": 9,
        "عشر": 10, "عشرة": 10,
    },

    // ═══════════════════════════════════════════════════════════════════════════════════
    // 📊 المثنى ← قيمته (2) + الوحدة الأساسية
    // ═══════════════════════════════════════════════════════════════════════════════════
    dualForms: {
        "ملعقتان صغيرتان": { value: 2, unit: "ملعقة صغيرة" },
        "ملعقتين صغيرتين": { value: 2, unit: "ملعقة صغيرة" },
        "ملعقتان كبيرتان": { value: 2, unit: "ملعقة كبيرة" },
        "ملعقتين كبيرتين": { value: 2, unit: "ملعقة كبيرة" },
        "ملعقتان": { value: 2, unit: "ملعقة صغيرة" },
        "ملعقتين": { value: 2, unit: "ملعقة صغيرة" },
        "كوبان": { value: 2, unit: "كوب" },
        "كوبين": { value: 2, unit: "كوب" },
        "حبتان": { value: 2, unit: "حبة" },
        "حبتين": { value: 2, unit: "حبة" },
        "فصان": { value: 2, unit: "فص" },
        "فصين": { value: 2, unit: "فص" },
        "رأسان": { value: 2, unit: "رأس" },
        "رأسين": { value: 2, unit: "رأس" },
        "حزمتان": { value: 2, unit: "حزمة" },
        "حزمتين": { value: 2, unit: "حزمة" },
        "قرصتان": { value: 2, unit: "قرصة" },
        "قرصتين": { value: 2, unit: "قرصة" },
        "شريحتان": { value: 2, unit: "شريحة" },
        "شريحتين": { value: 2, unit: "شريحة" },
        "رغيفان": { value: 2, unit: "رغيف" },
        "رغيفين": { value: 2, unit: "رغيف" },
    },

    // ═══════════════════════════════════════════════════════════════════════════════════
    // 🥄 الوحدات وتصريفاتها بكل لغة - مُحدَّثة
    // ═══════════════════════════════════════════════════════════════════════════════════
    units: {
        "ملعقة صغيرة": {
            ar_variants: ["ملعقة صغيرة", "ملاعق صغيرة"],
            en: { singular: "teaspoon", plural: "teaspoons" },
            ru: { fractional: "чайной ложки", one: "чайная ложка", few: "чайные ложки", many: "чайных ложек" },
            fa: { base: "قاشق چای‌خوری" }
        },
        "ملعقة كبيرة": {
            ar_variants: ["ملعقة كبيرة", "ملاعق كبيرة"],
            en: { singular: "tablespoon", plural: "tablespoons" },
            ru: { fractional: "столовой ложки", one: "столовая ложка", few: "столовые ложки", many: "столовых ложек" },
            fa: { base: "قاشق غذاخوری" }
        },
        "كوب": {
            ar_variants: ["كوب", "أكواب"],
            en: { singular: "cup", plural: "cups" },
            ru: { fractional: "стакана", one: "стакан", few: "стакана", many: "стаканов" },
            fa: { base: "پیمانه" }
        },
        "ورقة": {
            ar_variants: ["ورقة", "ورقات", "أوراق", "ورق"],
            en: { singular: "leaf", plural: "leaves" },
            ru: { fractional: "листа", one: "лист", few: "листа", many: "листьев" },
            fa: { base: "برگ" }
        },
        "حبة": {
            ar_variants: ["حبة", "حبات", "حبة صغيرة", "حبة كبيرة", "حبة متوسطة"],
            en: { singular: "piece", plural: "pieces" },
            ru: { fractional: "штуки", one: "штука", few: "штуки", many: "штук" },
            fa: { base: "عدد" }
        },
        "فص": {
            ar_variants: ["حص","حصوص","فص", "فصوص"],  // ✅ إضافة "حص"
            en: { singular: "clove", plural: "cloves" },
            ru: { fractional: "зубчика", one: "зубчик", few: "зубчика", many: "зубчиков" },
            fa: { base: "حبه" }
        },
        "رأس": {
            ar_variants: ["رأس", "رؤوس"],
            en: { singular: "head", plural: "heads" },
            ru: { fractional: "головки", one: "головка", few: "головки", many: "головок" },
            fa: { base: "عدد" }
        },
        "حزمة": {
            ar_variants: ["حزمة", "حزم", "باقة", "ربطة"],
            en: { singular: "bunch", plural: "bunches" },
            ru: { fractional: "пучка", one: "пучок", few: "пучка", many: "пучков" },
            fa: { base: "دسته" }
        },
        "قرصة": {
            ar_variants: ["قرصة", "قرصات"],
            en: { singular: "pinch", plural: "pinches" },
            ru: { fractional: "щепотки", one: "щепотка", few: "щепотки", many: "щепоток" },
            fa: { base: "نوک قاشق" }
        },
        "رشة": {  // ✅ إضافة وحدة جديدة
            ar_variants: ["رشة", "رشات"],
            en: { singular: "dash", plural: "dashes" },
            ru: { fractional: "щепотки", one: "щепотка", few: "щепотки", many: "щепоток" },
            fa: { base: "کمی" }
        },
        "شريحة": {
            ar_variants: ["شريحة", "شرائح"],
            en: { singular: "slice", plural: "slices" },
            ru: { fractional: "ломтика", one: "ломтик", few: "ломтика", many: "ломтиков" },
            fa: { base: "برش" }
        },
        "قطعة": {
            ar_variants: ["قطعة", "قطع"],
            en: { singular: "piece", plural: "pieces" },
            ru: { fractional: "кусочка", one: "кусочек", few: "кусочка", many: "кусочков" },
            fa: { base: "تکه" }
        },
        "رغيف": {  // ✅ إضافة وحدة جديدة
            ar_variants: ["رغيف", "أرغفة", "خبزة"],
            en: { singular: "loaf", plural: "loaves" },
            ru: { fractional: "лепёшки", one: "лепёшка", few: "лепёшки", many: "лепёшек" },
            fa: { base: "نان" }
        },
        "غرام": {
            ar_variants: ["غرام", "غراماً", "جرام", "جراماً", "غ", "جم"],
            en: { singular: "gram", plural: "grams" },
            ru: { fractional: "грамма", one: "грамм", few: "грамма", many: "граммов" },
            fa: { base: "گرم" }
        },
        "كيلوغرام": {
            ar_variants: ["كيلوغرام", "كيلو", "كغ", "كجم"],
            en: { singular: "kilogram", plural: "kilograms" },
            ru: { fractional: "килограмма", one: "килограмм", few: "килограмма", many: "килограммов" },
            fa: { base: "کیلوگرم" }
        },
        "لتر": {
            ar_variants: ["لتر", "ليتر", "لترات"],
            en: { singular: "liter", plural: "liters" },
            ru: { fractional: "литра", one: "литр", few: "литра", many: "литров" },
            fa: { base: "لیتر" }
        },
  "مل": {
    ar_variants: ["مللتر", "ملليلتر", "ملل"],  // ✅ حذفت "مل" لأنها تتضارب مع "ملعقة"
    en: { singular: "ml", plural: "ml" },
    ru: { fractional: "мл", one: "мл", few: "мл", many: "мл" },
    fa: { base: "میلی‌لیتر" }
},
    },

    // ═══════════════════════════════════════════════════════════════════════════════════
    // 🔢 رموز الكسور للعرض
    // ═══════════════════════════════════════════════════════════════════════════════════
    fractionSymbols: {
        0.25: "¼", 0.33: "⅓", 0.5: "½", 0.66: "⅔", 0.75: "¾",
        1.25: "1¼", 1.33: "1⅓", 1.5: "1½", 1.66: "1⅔", 1.75: "1¾",
        2.25: "2¼", 2.33: "2⅓", 2.5: "2½", 2.66: "2⅔", 2.75: "2¾",
        3.25: "3¼", 3.33: "3⅓", 3.5: "3½", 3.66: "3⅔", 3.75: "3¾",
        4.5: "4½", 4.25: "4¼", 4.75: "4¾",
        5.5: "5½", 6.5: "6½", 7.5: "7½", 8.5: "8½", 9.5: "9½",
    },

    // ═══════════════════════════════════════════════════════════════════════════════════
    // ⚙️ دوال التصريف حسب اللغة
    // ═══════════════════════════════════════════════════════════════════════════════════

    getEnglishForm(quantity, unitData) {
        return (quantity === 1) ? unitData.singular : unitData.plural;
    },

    getRussianForm(quantity, unitData) {
        if (quantity < 1) return unitData.fractional;

        const intPart = Math.floor(quantity);
        const hasFraction = (quantity !== intPart);

        // إذا كان هناك كسر، نستخدم صيغة الجر (المضاف إليه)
        if (hasFraction) return unitData.fractional;

        const lastDigit = intPart % 10;
        const lastTwoDigits = intPart % 100;

        if (lastTwoDigits >= 11 && lastTwoDigits <= 14) return unitData.many;
        if (lastDigit === 1) return unitData.one;
        if (lastDigit >= 2 && lastDigit <= 4) return unitData.few;
        return unitData.many;
    },

    getPersianForm(quantity, unitData) {
        return unitData.base;
    },

    formatNumber(num, lang) {
        const roundedNum = Math.round(num * 100) / 100;
        if (this.fractionSymbols[roundedNum]) {
            return this.fractionSymbols[roundedNum];
        }
        if (Number.isInteger(num)) {
            return String(num);
        }
        // للأعداد العشرية بدون رمز كسر
        return (lang === 'ru') ? String(roundedNum).replace('.', ',') : String(roundedNum);
    },

    // ═══════════════════════════════════════════════════════════════════════════════════
    // 🎯 الدالة الرئيسية: ترجمة مقدار كامل
    // ═══════════════════════════════════════════════════════════════════════════════════
    translate(quantity, unitKey, lang) {
        const unitData = this.units[unitKey];
        if (!unitData || !unitData[lang]) return null;

        const formattedNum = this.formatNumber(quantity, lang);
        let unitForm;

        switch (lang) {
            case 'en': unitForm = this.getEnglishForm(quantity, unitData.en); break;
            case 'ru': unitForm = this.getRussianForm(quantity, unitData.ru); break;
            case 'fa': unitForm = this.getPersianForm(quantity, unitData.fa); break;
            default: return null;
        }

        return `${formattedNum} ${unitForm}`;
    },
};

// ═══════════════════════════════════════════════════════════════════════════════════════
// 📖 محلل النص العربي - الإصدار المُصحَّح V3 (إصلاح مشكلة الوحدات الجزئية)
// ═══════════════════════════════════════════════════════════════════════════════════════

const ArabicQuantityParser = {

    parse(text) {
        let quantity = 0;
        let unit = null;
        let remaining = String(text || '').trim();
        let foundNumber = false;
        let foundUnit = false;

        console.log(`[Parser] Input: "${remaining}"`);

        // ─────────────────────────────────────────────────────────────────────────────
        // 1. البحث عن رقم في البداية
        // ─────────────────────────────────────────────────────────────────────────────
        const numMatch = remaining.match(/^(\d+(?:[.,]\d+)?)\s*/);
        if (numMatch) {
            quantity = parseFloat(numMatch[1].replace(',', '.'));
            remaining = remaining.slice(numMatch[0].length).trim();
            foundNumber = true;
            console.log(`[Parser] Found number: ${quantity}, remaining: "${remaining}"`);
        }

        // ─────────────────────────────────────────────────────────────────────────────
        // 2. البحث عن كسر في البداية (نصف، ربع، ثلاثة أرباع)
        // ─────────────────────────────────────────────────────────────────────────────
        const sortedFractions = Object.keys(QuantityTranslator.fractions).sort((a, b) => b.length - a.length);
        for (const fracWord of sortedFractions) {
            if (remaining.startsWith(fracWord)) {
                quantity += QuantityTranslator.fractions[fracWord];
                remaining = remaining.slice(fracWord.length).trim();
                foundNumber = true;
                console.log(`[Parser] Found leading fraction: ${fracWord}, quantity now: ${quantity}`);
                break;
            }
        }

        // ─────────────────────────────────────────────────────────────────────────────
        // 3. البحث عن المثنى (ملعقتان صغيرتان، كوبان، إلخ)
        // ─────────────────────────────────────────────────────────────────────────────
        const sortedDuals = Object.keys(QuantityTranslator.dualForms).sort((a, b) => b.length - a.length);
        for (const dualWord of sortedDuals) {
            if (remaining.includes(dualWord)) {
                const dualData = QuantityTranslator.dualForms[dualWord];
                if (!foundNumber) quantity = dualData.value;
                else quantity += dualData.value;
                unit = dualData.unit;
                remaining = remaining.replace(dualWord, '').trim();
                foundNumber = true;
                foundUnit = true;
                console.log(`[Parser] Found dual: ${dualWord}, unit: ${unit}, quantity: ${quantity}`);
                break;
            }
        }

        // ─────────────────────────────────────────────────────────────────────────────
        // 4. ✅ تحديد الوحدة (مع حماية من المطابقة الجزئية)
        // ─────────────────────────────────────────────────────────────────────────────
        if (!foundUnit) {
            // جمع كل الوحدات مع variants
            const allVariants = [];
            for (const unitKey in QuantityTranslator.units) {
                const unitData = QuantityTranslator.units[unitKey];
                for (const variant of unitData.ar_variants) {
                    allVariants.push({ variant, unitKey });
                }
            }
            // ✅ ترتيب من الأطول للأقصر (مهم جداً!)
            allVariants.sort((a, b) => b.variant.length - a.variant.length);

            for (const { variant, unitKey } of allVariants) {
                // ✅ استخدام regex للتأكد من أن الوحدة كلمة كاملة وليست جزء من كلمة
                const regex = new RegExp(`(^|\\s)(${variant})($|\\s|و)`, 'u');
                const match = remaining.match(regex);

                if (match) {
                    unit = unitKey;
                    // إزالة الوحدة فقط (مع الحفاظ على المسافات)
                    remaining = remaining.replace(match[2], ' ').trim();
                    foundUnit = true;
                    console.log(`[Parser] Found unit: ${unitKey} (from variant: "${variant}")`);
                    break;
                }
            }
        }

        // ─────────────────────────────────────────────────────────────────────────────
        // 5. إذا وجدنا وحدة ولم نجد رقم، الكمية الافتراضية = 1
        // ─────────────────────────────────────────────────────────────────────────────
        if (foundUnit && !foundNumber) {
            quantity = 1;
            foundNumber = true;
            console.log(`[Parser] No number found, defaulting to 1`);
        }

        // ─────────────────────────────────────────────────────────────────────────────
        // 6. البحث عن "ونصف" أو "وربع" في النص المتبقي
        // ─────────────────────────────────────────────────────────────────────────────
        const suffixFractions = {
            "وثلاثة أرباع": 0.75,
            "ونصف": 0.5,
            "وربع": 0.25,
            "وثلث": 0.33,
        };
        for (const [suffix, value] of Object.entries(suffixFractions)) {
            if (remaining.includes(suffix)) {
                quantity += value;
                remaining = remaining.replace(suffix, '').trim();
                console.log(`[Parser] Found suffix fraction: ${suffix}, quantity now: ${quantity}`);
                break;
            }
        }

        // ─────────────────────────────────────────────────────────────────────────────
        // 7. ✅ إزالة الصفات المتبقية من remaining (للتنظيف فقط)
        // ─────────────────────────────────────────────────────────────────────────────
        const descriptors = ["صغيرة", "كبيرة", "متوسطة", "واحدة", "واحد", "طازجة", "مفرومة", "مقطعة"];
        for (const desc of descriptors) {
            remaining = remaining.replace(new RegExp(desc, 'g'), '').trim();
        }

        console.log(`[Parser] Final: quantity=${quantity}, unit=${unit}, remaining="${remaining}"`);

        return { quantity, unit, unparsed: remaining.trim() };
    },

    translateText(arabicText, lang) {
        const parsed = this.parse(arabicText);

        if (!parsed.unit) {
            console.log(`[SmartTranslator] ⚠️ لم يتم التعرف على الوحدة في: "${arabicText}"`);
            return null;
        }

        const finalQuantity = parsed.quantity || 1;
        const translated = QuantityTranslator.translate(finalQuantity, parsed.unit, lang);

        if (!translated) {
            console.log(`[SmartTranslator] ⚠️ فشل في ترجمة: "${arabicText}"`);
            return null;
        }

        console.log(`[SmartTranslator] ✅ "${arabicText}" → "${translated}"`);
        return translated;
    }
};

// ═══════════════════════════════════════════════════════════════════════════════════════
// 🍽️ دالة الترجمة الرئيسية المُعدَّلة
// ═══════════════════════════════════════════════════════════════════════════════════════

/**
 * تُترجم وجبة الطعام بالكامل، مع التركيز على استبدال الكلمات العربية
 * المُولَّدة (مثل الكسور والروابط والوحدات) بنظيراتها في اللغة الهدف.
 * 🆕 تم دمج النظام الحسابي الذكي للمقادير
 */
function translateMeal(meal, currentLangCode) {

    console.log(`[TRACE_START] Starting translation for meal: ${meal.name_ar || meal.name} to language: ${currentLangCode}`);

    // ═══════════════════════════════════════════════════════════════════════════════
    // 1. منطق اللغة العربية: نُرجع البيانات الأصلية
    // ═══════════════════════════════════════════════════════════════════════════════
    if (currentLangCode === 'ar') {
        let preparation = meal.preparation_ar;
        const preparationSteps = Array.isArray(preparation) ? preparation : (preparation ? [preparation] : []);
        return {
            ...meal,
            name: meal.name_ar || meal.name,
            preparation: preparationSteps,
        };
    }

    // التحقق من كائن الترجمة
    if (typeof translations === 'undefined' || !translations[currentLangCode] || !translations.ar) {
        console.error(`[Translation Error] Missing translation data for: ${currentLangCode} or ar`);
        return { ...meal, name: meal.name_ar, preparation: meal.preparation_ar };
    }

    // ═══════════════════════════════════════════════════════════════════════════════
    // 2. منطق اللغات الأخرى (الأجنبية)
    // ═══════════════════════════════════════════════════════════════════════════════
    const langSuffix = '_' + currentLangCode;
    const translatedMeal = { ...meal };

    // ترجمة الاسم وطريقة التحضير
    const translatedNameField = 'name' + langSuffix;
    translatedMeal.name = translatedMeal[translatedNameField] || translatedMeal.name_ar;

    const translatedPreparationField = 'preparation' + langSuffix;
    let preparationData = meal[translatedPreparationField] || meal.preparation_ar;
    translatedMeal.preparation = Array.isArray(preparationData) ? preparationData : (preparationData ? [preparationData] : []);

    // ═══════════════════════════════════════════════════════════════════════════════
    // 3. ترجمة المكونات والوحدات والمقادير
    // ═══════════════════════════════════════════════════════════════════════════════
    if (meal.ingredients && meal.ingredients.length > 0) {

        translatedMeal.ingredients = meal.ingredients.map((originalIng, index) => {

            const itemField = 'item' + langSuffix;
            const translatedItem = originalIng[itemField] || originalIng.item_ar;

            const originalQuantityValue = originalIng.quantity;
            let translatedQuantity = (originalQuantityValue != null) ? String(originalQuantityValue) : "";
            const quantityAr = originalQuantityValue;

            if (translatedQuantity) {

                // ═══════════════════════════════════════════════════════════════════
                // 🆕 المحاولة الأولى: النظام الحسابي الذكي
                // ═══════════════════════════════════════════════════════════════════
                const smartTranslation = ArabicQuantityParser.translateText(translatedQuantity, currentLangCode);

                if (smartTranslation) {
                    // ✅ نجح النظام الذكي
                    translatedQuantity = smartTranslation;
                    console.log(`[TRACE_ING #${index}] ✅ Smart System: "${originalQuantityValue}" → "${translatedQuantity}"`);
                }
                else {
                    // ═══════════════════════════════════════════════════════════════
                    // 🔄 الخطة البديلة: النظام القديم (القواميس اليدوية)
                    // ═══════════════════════════════════════════════════════════════
                    console.log(`[TRACE_ING #${index}] ⚠️ Falling back to legacy system for: "${originalQuantityValue}"`);

                    const targetLangData = translations[currentLangCode];
                    const arabicLangData = translations.ar;

                    const targetQuantifiers = targetLangData.quantifiers || {};
                    const arabicQuantifiers = arabicLangData.quantifiers || {};
                    const targetUnitsMap = targetLangData.units || {};
                    const arabicUnitsMap = arabicLangData.units || {};
                    const targetDescriptors = targetLangData.descriptors || {};
                    const arabicDescriptors = arabicLangData.descriptors || {};

                    let textToTranslate = String(originalQuantityValue || '').trim();
                    const replacementMap = {};

                    // دمج المقادير، الصفات، والوحدات
                    for (const key in arabicQuantifiers) {
                        const arabicValue = arabicQuantifiers[key];
                        const targetValue = targetQuantifiers[key];
                        if (arabicValue && targetValue) replacementMap[arabicValue] = targetValue;
                    }
                    for (const key in arabicDescriptors) {
                        const arabicValue = arabicDescriptors[key];
                        const targetValue = targetDescriptors[key];
                        if (arabicValue && targetValue) replacementMap[arabicValue] = targetValue;
                    }
                    for (const key in arabicUnitsMap) {
                        const arabicValue = arabicUnitsMap[key];
                        const targetValue = targetUnitsMap[key];
                        if (arabicValue && targetValue) replacementMap[arabicValue] = targetValue;
                    }

                    // الإضافات اليدوية
                    if (targetQuantifiers['نصف']) replacementMap['نصف'] = targetQuantifiers['نصف'];
                    if (targetQuantifiers['ربع']) replacementMap['ربع'] = targetQuantifiers['ربع'];
                    if (targetQuantifiers['ثلاثة أرباع']) replacementMap['ثلاثة أرباع'] = targetQuantifiers['ثلاثة أرباع'];

                    if (targetDescriptors['متوسطة']) replacementMap['متوسطة'] = targetDescriptors['متوسطة'];
                    if (targetDescriptors['صغيرة']) replacementMap['صغيرة'] = targetDescriptors['صغيرة'];
                    if (targetDescriptors['واحدة']) replacementMap['واحدة'] = targetDescriptors['واحدة'];

                    replacementMap['و'] = targetLangData.linkers?.AND || 'and';

                    // الترجمات الخاصة بكل لغة
                    if (currentLangCode === 'ru') {
                        replacementMap['حسب الطلب'] = 'по вкусу';
                        replacementMap['من كل نوع'] = 'из каждого вида';
                        replacementMap['للتزيين'] = 'для украшения';
                        replacementMap['حسب الرغبة'] = 'по желанию';
                    } else if (currentLangCode === 'fa') {
                        replacementMap['حسب الطلب'] = 'به میزان دلخواه';
                        replacementMap['من كل نوع'] = 'از هر نوع';
                        replacementMap['للتزيين'] = 'برای تزیین';
                        replacementMap['حسب الرغبة'] = 'به دلخواه';
                    } else {
                        replacementMap['حسب الطلب'] = targetLangData.descriptors?.TO_TASTE || 'to taste';
                        replacementMap['من كل نوع'] = targetLangData.descriptors?.VARIETY || 'of each';
                        replacementMap['للتزيين'] = 'for garnish';
                        replacementMap['حسب الرغبة'] = 'as desired';
                    }

                    // تنفيذ الاستبدال
                    const sortedArabicWords = Object.keys(replacementMap).sort((a, b) => b.length - a.length);

                    try {
                        let paddedText = ' ' + textToTranslate + ' ';

                        for (const arabicWord of sortedArabicWords) {
                            const targetWord = replacementMap[arabicWord];
                            const arabicWordEscaped = arabicWord.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                            const regex = new RegExp(`\\s${arabicWordEscaped}\\s`, 'g');
                            paddedText = paddedText.replace(regex, ` ${targetWord} `);
                        }

                        translatedQuantity = paddedText.replace(/\s+/g, ' ').trim();
                        console.log(`[TRACE_ING #${index}] Legacy Result: "${translatedQuantity}"`);

                    } catch (error) {
                        console.error(`[Critical Error] Failed on ingredient ${index}. Error: ${error.message}`);
                        translatedQuantity = String(originalQuantityValue || '').trim();
                    }
                }
            }

            return {
                ...originalIng,
                item: translatedItem,
                unit: '',
                quantity: translatedQuantity,
                quantity_ar: quantityAr,
            };
        });
    }

    console.log(`[TRACE_END] Translation finished successfully.`);
    return translatedMeal;
}

// ====================================================================
// 4. الدوال الرئيسية (Core Functionality)
// ====================================================================

/**
 * دالة لاختيار وجبة عشوائية مطابقة للمعايير.
 */
function suggestMeal() {
    // 1. إخفاء رسالة التأكيد
    const confirmationMsg = document.getElementById('confirmationMsg');
    if (confirmationMsg) {
        confirmationMsg.style.display = 'none';
    }

    // 2. جلب القيم من الواجهة
    const healthStatus = document.getElementById('healthStatus').value;
    const cost = document.getElementById('cost').value;
    const mealTime = document.getElementById('mealTime').value;
    const weather = document.getElementById('weather').value;
    const mealType = document.getElementById('mealType').value;
    const numberOfpeople = document.getElementById('numberOfpeople').value; 

    if (typeof meals === 'undefined' || meals.length === 0) {
        return;
    }
    
    // تصفير سجل التاريخ عند بدء فلتر جديد
    window.suggestedMealsHistory = [];

    // منطق تصفية الوجبات
    const successfulMeals = [];
    const rejectedMeals = [];
    meals.forEach(meal => {
        if (!meal || !meal.health || !meal.cost || !meal.mealTime || !meal.weather || !meal.mealType) {
            return; 
        }

        const healthCheck = meal.health.includes(healthStatus);
        const costCheck = meal.cost.includes(cost);
        const mealTimeCheck = meal.mealTime.includes(mealTime);
        const weatherCheck = meal.weather.includes(weather); 
        const normalizedUserMealType = mealType.trim().toLowerCase();
        const mealTypeData = Array.isArray(meal.mealType) ? meal.mealType : [meal.mealType];

        const mealTypeCheck = mealTypeData
                            .map(type => String(type).trim().toLowerCase()) 
                            .includes(normalizedUserMealType);
        
        const passed = healthCheck && costCheck && mealTimeCheck && weatherCheck && mealTypeCheck;
        
          if (passed) {
            successfulMeals.push(meal);
        } else {
            // تخزين الوجبات المرفوضة وسبب الرفض (نفس المنطق السابق)
            const rejectionReasons = [];
            if (!healthCheck) rejectionReasons.push('الحالة الصحية (' + healthStatus + ')');
            if (!costCheck) rejectionReasons.push('التكلفة (' + cost + ')');
            if (!mealTimeCheck) rejectionReasons.push('وقت الوجبة (' + mealTime + ')');
            if (!weatherCheck) rejectionReasons.push('الطقس (' + weather + ')');
            if (!mealTypeCheck) rejectionReasons.push('نوع الوجبة (' + mealType + ')');
            
            rejectedMeals.push({
                id: meal.id,
                name: meal.name_ar,
                reasons: rejectionReasons,
                details: { healthCheck, costCheck, mealTimeCheck, weatherCheck, mealTypeCheck }
            });
        }
    });


    let filteredMeals = successfulMeals;
    window.lastFilteredMeals = filteredMeals;
    // =======================================================
    // 🎯 تقرير الوجبات المرفوضة (Rejected Meals Report)
    // =======================================================
    if (rejectedMeals.length > 0) {
        //console.log('----------------------------------------------------');//
        //console.warn(`❌ تم رفض ${rejectedMeals.length} وجبة. التقرير التفصيلي للرفض:`);//
       // rejectedMeals.forEach(rejected => {//
            //console.log(//
              //  `[ID: ${rejected.id} | ${rejected.name}] ⬅️ السبب الرئيسي للرفض: ${rejected.reasons.join('، ')}`//
          //  );//
       // });//
        //console.log('----------------------------------------------------');//
    }

    // =======================================================
    // 🎯 تقرير الوجبات الناجحة (Successful Meals Report)
    // =======================================================
    console.log(`✅ الوجبات التي عبرت التصفية بنجاح (${filteredMeals.length} وجبة):`);
    filteredMeals.forEach(meal => {
        console.log(`[ID: ${meal.id} | ${meal.name_ar}]`);
    });
    //console.log('----------------------------------------------------');//

    // 4. التعامل مع حالة عدم وجود نتائج
    if (filteredMeals.length === 0) {
        displayNoResults(false, false); 
        window.currentSuggestedMeal = null;
        window.suggestedMealsHistory = [];
        return;
    }

    // 5. اختيار وجبة عشوائية
    const randomIndex = Math.floor(Math.random() * filteredMeals.length);
    let suggestedMeal = filteredMeals[randomIndex]; 
    
    // 6. حساب المضاعف وتطبيق الاحتساب
    const multiplier = getQuantityMultiplier(numberOfpeople);
    suggestedMeal = calculateNewQuantities(suggestedMeal, multiplier);

    // 7. تخزين الوجبة الحالية (المحسوبة) وإضافتها إلى سجل التاريخ
    window.currentSuggestedMeal = suggestedMeal; 
    window.currentMultiplier = multiplier;
    window.suggestedMealsHistory.push(suggestedMeal.name_ar);

    // 8. عرض الوجبة
    displayMeal(suggestedMeal); 

    // 9. إظهار زر البديل والخروج
    document.getElementById('alternativeBtn').style.display = 'block';
    document.getElementById('exitBtn').style.display = 'block';
    //✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅//
     console.log('=== انتهى تنفيذ suggestMeal ===');
}


/**
 * دالة لاقتراح وجبة بديلة.
 */
function suggestAlternative() {
      //✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅//
     console.log('=== بدء تنفيذ suggestAlternative (مع الاحتساب ومنع التكرار) ===');

    const confirmationMsg = document.getElementById('confirmationMsg');
    if (confirmationMsg) {
        confirmationMsg.style.display = 'none';
    }

    let filteredMeals = window.lastFilteredMeals || [];
    let history = window.suggestedMealsHistory || [];
    
    if (filteredMeals.length === 0) {
        displayNoResults(false, true);
        return;
    }

    // 1. تصفية القائمة: إزالة الوجبات التي تم عرضها بالفعل
    let availableAlternatives = filteredMeals.filter(meal => {
        const mealName = meal.name_ar;
        return !history.includes(mealName);
    });
    
    // 2. فحص حالة الدورة: إذا كانت القائمة فارغة، قم بإعادة التصفير
    if (availableAlternatives.length === 0) {
        window.suggestedMealsHistory = [];
        history = [];

        availableAlternatives = filteredMeals.filter(meal => {
            const mealName = meal.name_ar;
            return !history.includes(mealName);
        });
    }
    
    // 3. إزالة الوجبة المعروضة حالياً
    const currentlySuggested = window.currentSuggestedMeal;
    
    if (currentlySuggested && currentlySuggested.name_ar) { 
        availableAlternatives = availableAlternatives.filter(meal => meal.name_ar !== currentlySuggested.name_ar);
    }

    if (availableAlternatives.length === 0) {
        displayNoResults(true, false); // رسالة "لا يوجد بديل"
        return;
    }
    
    // 4. اختيار وجبة عشوائية من القائمة الجديدة
    const randomIndex = Math.floor(Math.random() * availableAlternatives.length);
    let suggestedMeal = availableAlternatives[randomIndex];
    
    // 5. إضافة الوجبة الجديدة إلى سجل التاريخ
    window.suggestedMealsHistory.push(suggestedMeal.name_ar);
    //✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅✅//
     console.log('✅ الوجبة البديلة المختارة:', suggestedMeal.name_ar);
    console.log('السجل الحالي:', window.suggestedMealsHistory);
    // 6. حساب المضاعف وتطبيق الاحتساب
    const numberOfpeople = document.getElementById('numberOfpeople').value;
    const multiplier = getQuantityMultiplier(numberOfpeople);
    console.log('المضاعف (multiplier):', multiplier);
    suggestedMeal = calculateNewQuantities(suggestedMeal, multiplier); 
    console.log('✅ الوجبة المختارة (بعد الاحتساب):', suggestedMeal.name_ar);

    window.currentSuggestedMeal = suggestedMeal; 
    window.currentMultiplier = multiplier;
    window.suggestedMealsHistory.push(suggestedMeal.name_ar);

     // =======================================================
    // 🎯 عدد الوجبات البديلة المتبقية بعد اختيار الوجبة
    // =======================================================
    const alternativesRemaining = filteredMeals.length - 1;
    console.log(`💡 الوجبات البديلة المتبقية في هذه التصفية: ${alternativesRemaining}`);
    console.log('----------------------------------------------------');


    displayMeal(suggestedMeal); 
}

/**
 * دالة لعرض الوصفة على الواجهة (مع الترجمة).
 * @param {object} mealData كائن الوجبة المُحتسب والمُقترح.
 */
function displayMeal(mealData) { 
    const resultDiv = document.getElementById('result');
    if (!mealData) {
        // نفترض أن دالة displayNoResults معرفة خارجياً
        if (typeof displayNoResults === 'function') {
            displayNoResults(false, false); 
        }
        return; 
    } 
    
    // 1. ترجمة الوجبة إلى اللغة الحالية للواجهة
    const currentLangCode = document.documentElement.lang;
    const t = typeof translations !== 'undefined' ? translations[currentLangCode] : {}; // التأكد من تعريف t
    const translatedMeal = translateMeal(mealData, currentLangCode);
    
    // 2. فحص سلامة نتيجة الترجمة
    if (!translatedMeal) {
        console.error("Translated meal data is invalid.");
        return;
    }

    // 3. تحديد المكونات وطريقة التحضير باللغة الصحيحة
    const ingredientsToDisplay = translatedMeal.ingredients || []; 
    const preparationStepsList = translatedMeal.preparation || []; 
    
    // 4. بناء الـ HTML
    if (resultDiv) {
        resultDiv.innerHTML = `
            <div class="meal-layout">
                <h3 class="meal-title">🥗 ${translatedMeal.name}🥗</h3>
                 <div class="ingredient flex-row-aligned">
            </div>
           <div class="flex-start-group">
            <div class="flex-end-group">
       </div> 
                <div class="meal-content">
                    <div class="ingredients-section" lang="${currentLangCode}">
                        <strong>📋 ${t.ingredientsLabel || 'المكونات'}</strong> 
                        <div class="ingredients-list">
                            ${ingredientsToDisplay.map(ingredient => {
                                
                                const displayQuantity = ingredient.quantity || '';
                                const displayUnit = ingredient.unit || ''; 
                                
                                // 🟢 التعديل الجذري: نستخدم ingredient.item_ar كخيار بديل إذا كان ingredient.item فارغاً 
                                // (وهو ما يحدث عند الترجمة للعربية في حالتك)
                                const displayItem = ingredient.item || ingredient.item_ar || 'مكون غير معروف';
                                
                                let quantityAndUnitHtml = '';
                                
                                // منطق منع تكرار الوحدة (الذي تم إضافته سابقاً)
                                if (currentLangCode === 'ar' && displayQuantity.toString().includes(' ')) {
                                    quantityAndUnitHtml = `<span class="ingredient-quantity">${displayQuantity}</span>`;
                                } else {
                                    quantityAndUnitHtml = `<span class="ingredient-quantity">${displayQuantity} ${displayUnit}</span>`;
                                }

                                return `
                                <div class="ingredient">
                                    ${ingredient.emoji || (typeof getIngredientEmoji !== 'undefined' ? getIngredientEmoji(ingredient.item_ar) : '🍽️')} 
                                    <strong>${displayItem}</strong>
                                    ${quantityAndUnitHtml}
                                </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    <div class="preparation-section">
                        <strong>👩‍🍳 ${t.instructionsLabel || 'طريقة التحضير'}</strong>
                        <div class="preparation-steps">
                            ${preparationStepsList.map((step, index) => `
                                <div class="step">
                                    ${step.replace(/^\d+\.\s*/, '')} </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
        `;
    
        // 5. تحديث حالة الأزرار
        const suggestBtn = document.getElementById('suggestBtn');
        const alternativeBtn = document.getElementById('alternativeBtn');
        const exitBtn = document.getElementById('exitBtn');
        const confirmBtn = document.getElementById('confirmBtn');
        
        if (suggestBtn) suggestBtn.style.display = 'none';
        if (alternativeBtn) alternativeBtn.style.display = 'block';
        if (exitBtn) exitBtn.style.display = 'block';
        if (confirmBtn) confirmBtn.style.display = 'block';

        resultDiv.classList.add('result-success');
    }
}

// ... (بقية الدوال المساعدة مثل getIngredientEmoji)

// ====================================================================
// 5. دوال الإضافات (Auxiliary Functions)
// ====================================================================

/** دالة مساعدة للإيموجي */
function getIngredientEmoji(ingredientName) {
    const emojiMap = {
        'عدس': '🫘', 'جزر': '🥕', 'بصل': '🧅', 'ثوم': '🧄',
        'جرجير': '🥬', 'جبن': '🧀', 'طماطم': '🍅', 'خس': '🥬',
        'خيار': '🥒', 'لحم': '🥩', 'دجاج': '🍗', 'سمك': '🐟',
        'أرز': '🍚', 'معكرونة': '🍝', 'بيض': '🥚', 'حليب': '🥛',
        'ماء': '💧', 'مرق': '🍲', 'زيت': '🫒', 'ليمون': '🍋',
        'فلفل': '🌶️', 'ملح': '🧂', 'فطر': '🍄', 'بطاطا': '🥔'
    };
    return emojiMap[ingredientName] || '🌱';
}

/** دالة مسح النتائج من الشاشة */
function clearResults() {
    const resultDiv = document.getElementById('result');
    if (resultDiv) {
        resultDiv.innerHTML = '';
        resultDiv.classList.remove('result-success');
        document.getElementById('suggestBtn').style.display = 'block'; // إعادة زر الاقتراح
        document.getElementById('alternativeBtn').style.display = 'none';
        document.getElementById('exitBtn').style.display = 'none';
        document.getElementById('confirmBtn').style.display = 'none';
    }
}

/** دالة عرض رسالة "صحتين وعافية" المترجمة */
function showHealthMessage() {
    const currentLangCode = document.documentElement.lang;
    const messages = {
        'ar': '🍽️ صحتين وعافية 🍽️',
        'en': '🍽️ Bon Appétit 🍽️',
        'ru': '🍽️ Приятного аппетита 🍽️',
        'fa': '🍽️ نوش جان 🍽️'
    };
    const message = messages[currentLangCode] || messages['ar'];

    const msgElement = document.createElement('div');
    msgElement.className = 'health-message';
    msgElement.textContent = message;
    document.body.appendChild(msgElement);
    
    setTimeout(() => {
        if (document.body.contains(msgElement)) {
            document.body.removeChild(msgElement);
        }
    }, 3000);
}


// ====================================================================
// 6. دالة عرض الساعة الرقمية (Clock Functionality)
// ====================================================================

/** دالة عرض الساعة الرقمية (محدثة لدعم لغات متعددة) */
function updateClock() {
    const now = new Date();
    
    let locale = 'en-US';
    let currentLangCode = document.documentElement.lang;

    if (currentLangCode === 'ar' || currentLangCode === 'fa') {
        locale = 'en-EG'; // استخدام الأرقام العربية
    } else if (currentLangCode === 'ru') {
        locale = 'ru-RU';
    }
    
    const timeString = now.toLocaleTimeString(locale, {
        hour: '2-digit',
        minute: '2-digit',
        hour12: false // صيغة 24 ساعة
    });

    document.getElementById('timeDisplay').textContent = timeString;
}

// تحديث الساعة كل ثانية (يجب أن يكون 'timeDisplay' موجودًا في HTML)
setInterval(updateClock, 1000);
updateClock(); 

// ====================================================================
// 7. مُستمع بدء التشغيل وربط الأحداث (Initialization & Listeners)
// ====================================================================

document.addEventListener('DOMContentLoaded', () => {
    // 1. تطبيق اللغة المحفوظة عند التحميل الأولي
    const savedLanguage = localStorage.getItem('preferredLang') || 'ar';
    applyUITranslation(savedLanguage);
    highlightActiveLanguageButton(savedLanguage); 

    // 2. ربط أزرار اللغة (lang-btn) بـ handleLanguageToggle
    const langButtons = document.querySelectorAll('.lang-btn'); 
    langButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            const langCode = event.target.getAttribute('data-lang');
            handleLanguageToggle(langCode); 
        });
    });

    // 3. ربط أزرار الوظائف الرئيسية
    document.getElementById('suggestBtn').addEventListener('click', suggestMeal);
    document.getElementById('alternativeBtn').addEventListener('click', suggestAlternative);

    document.getElementById('confirmBtn').addEventListener('click', () => {
        const confirmationMsg = document.getElementById('confirmationMsg');
        confirmationMsg.style.display = 'block';

        setTimeout(() => {
            confirmationMsg.style.display = 'none';
            showHealthMessage();
        }, 1000); 
    });

    document.getElementById('exitBtn').addEventListener('click', () => {
        const resultDiv = document.getElementById('result');
        if (!resultDiv || !resultDiv.innerHTML.trim()) {
            return; 
        } 
        
        clearResults();
        
        const currentLangCode = document.documentElement.lang;
        const exitMessages = {
            'ar': ' تم إنهاء الجلسة. شكراً لاستخدامك تطبيق "شو عاملي أكل؟" ',
            'en': '👋 ? Session Ended. Thank you for using "What\'s Cooking " 👋',
            'ru': '👋 ?Сеанс завершен. Спасибо за использование приложения"Что пргатовила". 👋',
            'fa': '👋 جلسه به پایان رسید. از شما بابت استفاده از برنامه «چی می‌پزی؟» متشکریم. 👋'
        };
        const exitMessage = exitMessages[currentLangCode] || exitMessages['ar'];

        const msgElement = document.createElement('div');
        msgElement.className = 'health-message';
        msgElement.textContent = exitMessage;
        msgElement.style.background = 'rgba(175, 50, 50, 0.95)'; 
        msgElement.style.borderColor = '#FF6B6B';
        msgElement.style.color = '#FFDDDD';
        
        document.body.appendChild(msgElement);
        
        setTimeout(() => {
            if (document.body.contains(msgElement)) {
                document.body.removeChild(msgElement);
            }
            window.currentSuggestedMeal = null;
            // يمكنك توجيه المستخدم لصفحة أخرى إذا لزم الأمر
            window.location.href = 'index.html';
        }, 10000);
    });
    
    // 4. عرض رسالة البداية المترجمة عند التحميل
    displayNoResults(false, true); 
});
</script>
</body>

</html>

